(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
(function() {
  var Momic, applyHooks, defer, dequal, uuid,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  defer = function(f) {
    return new Promise((function(_this) {
      return function(done, reject) {
        return f(done, reject);
      };
    })(this));
  };

  uuid = (function(_this) {
    return function() {
      var s4;
      s4 = function() {
        return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
      };
      return s4() + s4() + s4() + s4();
    };
  })(this);

  
function clone(obj) {
    if (null == obj || "object" != typeof obj) return obj;
    var copy = obj.constructor();
    for (var attr in obj) {
        if (obj.hasOwnProperty(attr)) copy[attr] = obj[attr];
    }
    return copy;
}
;

  dequal = function(left, right) {
    var i, isLeftPrimitive, isRightPrimitive, key, results, _ref, _ref1;
    isLeftPrimitive = (_ref = typeof left) === 'string' || _ref === 'number' || _ref === 'boolean' || _ref === 'undefined';
    isRightPrimitive = (_ref1 = typeof right) === 'string' || _ref1 === 'number' || _ref1 === 'boolean' || _ref1 === 'undefined';
    if (isLeftPrimitive && isRightPrimitive) {
      return left === right;
    }
    if (isLeftPrimitive || isRightPrimitive) {
      return false;
    }
    results = (function() {
      var _i, _len, _results, _results1;
      if (left instanceof Array) {
        _results = [];
        for (_i = 0, _len = left.length; _i < _len; _i++) {
          i = left[_i];
          _results.push(dequal(left[i], right[i]));
        }
        return _results;
      } else if (left instanceof Object) {
        _results1 = [];
        for (key in left) {
          _results1.push(dequal(left[key], right[key]));
        }
        return _results1;
      }
    })();
    return (results.filter(function(item) {
      return item;
    })).length === results.length;
  };

  applyHooks = function(items, hooks) {
    var hook, i, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = items.length; _i < _len; _i++) {
      i = items[_i];
      _results.push((function() {
        var _j, _len1, _results1;
        _results1 = [];
        for (_j = 0, _len1 = hooks.length; _j < _len1; _j++) {
          hook = hooks[_j];
          _results1.push(hook(i));
        }
        return _results1;
      })());
    }
    return _results;
  };

  Momic = {};

  Momic.deepClone = clone;

  Momic.Collection = (function() {
    Collection.dequal = dequal;

    Collection.prototype.addPlugin = function(_arg) {
      var initialize, postSaveHook, preInsertHook, preSaveHook;
      initialize = _arg.initialize, preInsertHook = _arg.preInsertHook, this.preUpdateHook = _arg.preUpdateHook, preSaveHook = _arg.preSaveHook, postSaveHook = _arg.postSaveHook;
      if (initialize != null) {
        initialize(this);
      }
      if (preInsertHook != null) {
        this.preInsertHooks.push(preInsertHook);
      }
      if (typeof preUpdateHook !== "undefined" && preUpdateHook !== null) {
        this.preUpdateHooks.push(preUpdateHook);
      }
      if (preSaveHook != null) {
        this.preSaveHooks.push(preSaveHook);
      }
      if (postSaveHook != null) {
        return this.postSaveHooks.push(postSaveHook);
      }
    };

    function Collection(key, _arg) {
      var IdAutoInsertionPlugin, plugin, _i, _len, _ref;
      this.key = key;
      this.schema = _arg.schema, this.hasInstance = _arg.hasInstance, this.hasPersistence = _arg.hasPersistence, this.endpoint = _arg.endpoint, this.autoSave = _arg.autoSave, this.plugins = _arg.plugins, this.indexes = _arg.indexes;
      this.init = __bind(this.init, this);
      this.remove = __bind(this.remove, this);
      this.find = __bind(this.find, this);
      this.getById = __bind(this.getById, this);
      this.findById = __bind(this.findById, this);
      this.findOne = __bind(this.findOne, this);
      this.drop = __bind(this.drop, this);
      this.insert = __bind(this.insert, this);
      this.update = __bind(this.update, this);
      this.save = __bind(this.save, this);
      this.saved = __bind(this.saved, this);
      this.loadContent = __bind(this.loadContent, this);
      this.updateInstanceIfNeeded = __bind(this.updateInstanceIfNeeded, this);
      this.load = __bind(this.load, this);
      this.count = __bind(this.count, this);
      this._updateCount = __bind(this._updateCount, this);
      this.updateIndex = __bind(this.updateIndex, this);
      this.resetItemsIndex = __bind(this.resetItemsIndex, this);
      if (this.autoSave == null) {
        this.autoSave = true;
      }
      if (this.hasPersistence == null) {
        this.hasPersistence = true;
      }
      if (this.hasInstance == null) {
        this.hasInstance = true;
      }
      this.preInsertHooks = [];
      this.preUpdateHooks = [];
      this.preSaveHooks = [];
      this.postSaveHooks = [];
      IdAutoInsertionPlugin = {
        preInsertHook: function(item) {
          return item.id != null ? item.id : item.id = uuid();
        }
      };
      this.addPlugin(IdAutoInsertionPlugin);
      if (this.plugins != null) {
        _ref = this.plugins;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          plugin = _ref[_i];
          this.addPlugin(plugin);
        }
      }
      if (!(this.hasInstance || this.hasPersistence)) {
        throw new Error('hasInstance or hasPersistence must be true');
      }
      this._count = 0;
      this._instance = null;
      if (this.indexes == null) {
        this.indexes = ['id'];
      }
      this._indexesData = {};
    }

    Collection.prototype.initIndexes = function() {
      var indexName, _i, _len, _ref, _results;
      _ref = this.indexes;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        indexName = _ref[_i];
        _results.push(this.resetItemsIndex(indexName));
      }
      return _results;
    };

    Collection.prototype.resetItemsIndex = function(indexName) {
      var item, _i, _len, _ref, _results;
      this._indexesData[indexName] = {};
      _ref = this._instance;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        item = _ref[_i];
        _results.push(this.updateIndex(indexName, item[indexName]));
      }
      return _results;
    };

    Collection.prototype.updateIndex = function(indexName, val, index) {
      var indexes;
      indexes = this._indexesData[indexName];
      if (indexes[val] != null) {
        return indexes[val].push(index);
      } else {
        return this._indexesData[indexName][val] = [index];
      }
    };

    Collection.prototype._updateCount = function(_count) {
      this._count = _count;
    };

    Collection.prototype.count = function() {
      return this._count;
    };

    Collection.prototype.load = function() {
      return defer((function(_this) {
        return function(done) {
          return localforage.getItem(_this.key).then(function(content) {
            return done(content);
          });
        };
      })(this));
    };

    Collection.prototype.updateInstanceIfNeeded = function(instance) {
      if (this.hasInstance) {
        return this._instance = instance;
      }
    };

    Collection.prototype.loadContent = function() {
      return defer((function(_this) {
        return function(done) {
          if (_this.hasInstance && _this._instance) {
            return done(_this._instance);
          } else {
            return _this.load().then(function(content) {
              return done(content);
            });
          }
        };
      })(this));
    };

    Collection.prototype.saved = function() {
      return this._saved;
    };

    Collection.prototype.save = function(content) {
      return defer((function(_this) {
        return function(done) {
          var hook, tosave, _i, _len, _ref;
          if (!_this.hasPersistence) {
            throw "`" + _this.key + "` collection doesn't have storage";
          }
          tosave = content != null ? content : _this._instance;
          _ref = _this.preSaveHooks;
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            hook = _ref[_i];
            hook(tosave);
          }
          return localforage.setItem(_this.key, tosave).then(function() {
            var _j, _len1, _ref1;
            _this.updateInstanceIfNeeded(tosave);
            _this._saved = true;
            _ref1 = _this.postSaveHooks;
            for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
              hook = _ref1[_j];
              hook(tosave);
            }
            return done();
          });
        };
      })(this));
    };

    Collection.prototype.update = function(obj) {
      return defer((function(_this) {
        return function(done) {
          var array;
          array = obj.length != null ? obj : [obj];
          return _this.loadContent().then(function(content) {
            var c, item, key, n, val, _i, _j, _len, _len1;
            for (_i = 0, _len = array.length; _i < _len; _i++) {
              item = array[_i];
              for (n = _j = 0, _len1 = content.length; _j < _len1; n = ++_j) {
                c = content[n];
                if (c.id === item.id) {
                  for (key in item) {
                    val = item[key];
                    content[n][key] = val;
                  }
                  break;
                }
              }
            }
            applyHooks(content, _this.preUpdateHooks);
            _this.updateInstanceIfNeeded(content);
            if (_this.autoSave) {
              return _this.save(content).then(function() {
                return done(clone(array));
              });
            } else {
              _this._saved = false;
              return done(clone(array));
            }
          });
        };
      })(this));
    };

    Collection.prototype.insert = function(obj) {
      return defer((function(_this) {
        return function(done) {
          var array, ret;
          array = obj.length ? obj.map(function(i) {
            var ret;
            ret = clone(i);
            return ret;
          }) : (ret = clone(obj), [ret]);
          applyHooks(array, _this.preInsertHooks);
          return _this.loadContent().then(function(content) {
            var beforeIndexLength, i, n, _i, _j, _len, _len1;
            beforeIndexLength = content.length;
            for (_i = 0, _len = array.length; _i < _len; _i++) {
              i = array[_i];
              content.push(i);
            }
            for (n = _j = 0, _len1 = array.length; _j < _len1; n = ++_j) {
              i = array[n];
              _this.updateIndex('id', i.id, beforeIndexLength + n);
            }
            _this._updateCount(content.length);
            if (_this.autoSave) {
              return _this.save().then(function() {
                if (_this.hasInstance) {
                  _this._instance = content;
                }
                return done(clone(array));
              });
            } else {
              _this._saved = false;
              if (_this.hasInstance) {
                _this._instance = content;
              }
              return done(clone(array));
            }
          });
        };
      })(this));
    };

    Collection.prototype.drop = function() {
      return defer((function(_this) {
        return function(done) {
          return localforage.setItem(_this.key, []).then(function() {
            return done();
          });
        };
      })(this));
    };

    Collection.prototype.findOne = function(func_or_obj) {
      return defer((function(_this) {
        return function(done) {
          return _this.find(func_or_obj).then(function(_arg) {
            var first;
            first = _arg[0];
            return done(clone(first));
          });
        };
      })(this));
    };

    Collection.prototype.findById = function(id) {
      return defer((function(_this) {
        return function(done) {
          var index;
          if (!_this.hasInstance) {
            throw 'need hasInstance';
          }
          index = _this._indexesData['id'][id][0];
          return done(clone(_this._instance[index]));
        };
      })(this));
    };

    Collection.prototype.getById = function(id) {
      var index;
      if (!this.hasInstance) {
        throw 'need hasInstance';
      }
      index = this._indexesData['id'][id][0];
      return clone(this._instance[index]);
    };

    Collection.prototype.find = function(func_or_obj) {
      if (func_or_obj == null) {
        func_or_obj = null;
      }
      return defer((function(_this) {
        return function(done) {
          return _this.loadContent().then(function(content) {
            var func, queryObj, results;
            results = func_or_obj == null ? content : (func = func_or_obj) instanceof Function ? content.filter(function(item) {
              return func(item);
            }) : (queryObj = func_or_obj) instanceof Object ? content.filter(function(item) {
              return dequal(queryObj, item);
            }) : void 0;
            return done(clone(results));
          });
        };
      })(this));
    };

    Collection.prototype.remove = function(func_or_obj) {
      var d;
      return d = defer((function(_this) {
        return function(done) {
          var c, loading;
          c = null;
          loading = defer(function(done) {
            return _this.loadContent().then(function(content) {
              c = content;
              return done(content);
            });
          });
          return loading.then(function(content) {
            return _this.find(func_or_obj).then(function(toremove) {
              var remove_ids;
              remove_ids = toremove.map(function(i) {
                return i.id;
              });
              content = content.filter(function(item) {
                var _ref;
                return _ref = item.id, __indexOf.call(remove_ids, _ref) < 0;
              });
              return _this.save(content).then(function() {
                _this._updateCount(content.length);
                return done();
              });
            });
          });
        };
      })(this));
    };

    Collection.prototype.init = function() {
      return defer((function(_this) {
        return function(done) {
          return localforage.getItem(_this.key, function(content) {
            if (content == null) {
              content = [];
            }
            if (_this.hasInstance) {
              _this._instance = content;
              _this.initIndexes();
            }
            if (_this.hasPersistence) {
              return _this.save(content).then(function() {
                return done();
              });
            } else {
              _this._updateCount(content.length);
              return done();
            }
          });
        };
      })(this));
    };

    return Collection;

  })();

  Momic.DB = (function() {
    DB.prototype.collectionKey = function(collectionName) {
      return this.prefix + '_' + collectionName;
    };

    function DB(opts) {
      this.init = __bind(this.init, this);
      this.collectionKey = __bind(this.collectionKey, this);
      var colOpts, key, _ref;
      this.initialized = false;
      this.prefix = (opts != null ? opts.name : void 0) || '';
      this.storage = (opts != null ? opts.storage : void 0) || 'localforage';
      this.collections = [];
      _ref = opts != null ? opts.collections : void 0;
      for (key in _ref) {
        colOpts = _ref[key];
        this.addCollection(key, colOpts);
      }
    }

    DB.prototype.init = function() {
      return defer((function(_this) {
        return function(done) {
          var inits;
          inits = _this.collections.map(function(col) {
            return col.init();
          });
          return Promise.all(inits).then(function() {
            _this.initialized = true;
            return done();
          });
        };
      })(this));
    };

    DB.prototype.addCollection = function(key, colOpts) {
      if (key === 'initialized' || key === 'prefix' || key === 'storage' || key === 'init' || key === 'collectionKey' || key === 'addCollection') {
        throw new Error("'" + key + "' is reserved word");
      }
      if (colOpts.storage == null) {
        colOpts.storage = this.storage;
      }
      this[key] = new Momic.Collection(this.collectionKey(key), colOpts);
      this.collections.push(this[key]);
      if (this.initialized) {
        return defer((function(_this) {
          return function(done) {
            return _this[key].init().then(function() {
              return done();
            });
          };
        })(this));
      } else {
        return this[key];
      }
    };

    return DB;

  })();

  Momic.Model = (function() {
    Model.setup = function(opts) {
      return defer(function(done) {
        var db;
        db = new Momic.DB(opts);
        return db.init().then(function() {
          return done();
        });
      });
    };

    Model.setDB = function(db) {
      return Model._db = db;
    };

    Model.getDB = function() {
      return Model._db;
    };

    Model.count = function() {
      return this.getCollection().count();
    };

    Model.extend = function(obj) {
      var cls, key, val;
      cls = (function(_super) {
        __extends(_Class, _super);

        function _Class() {
          return _Class.__super__.constructor.apply(this, arguments);
        }

        return _Class;

      })(this);
      for (key in obj) {
        val = obj[key];
        cls.prototype[key] = val;
      }
      return cls;
    };

    Model.getCollection = function() {
      var db;
      if (!this.prototype.key) {
        throw 'Need key';
      }
      db = this.getDB();
      return db[this.prototype.key];
    };

    Model.find = function(query) {
      return defer((function(_this) {
        return function(done) {
          var col;
          col = _this.getCollection();
          return col.find(query).then(function(items) {
            return done(items.map(function(item) {
              return new _this(item);
            }));
          });
        };
      })(this));
    };

    Model.remove = function(query) {
      return defer((function(_this) {
        return function(done) {
          var col;
          col = _this.getCollection();
          return col.remove(query).then(function() {
            return done();
          });
        };
      })(this));
    };

    Model.update = function(obj) {
      return defer((function(_this) {
        return function(done) {
          var col;
          col = _this.getCollection();
          return col.update(obj).then(function(updatedItems) {
            return done(updatedItems.map(function(item) {
              return new _this(item);
            }));
          });
        };
      })(this));
    };

    Model.insert = function(obj) {
      return defer((function(_this) {
        return function(done) {
          var col;
          col = _this.getCollection();
          return col.insert(obj).then(function(insertedItems) {
            return done(insertedItems.map(function(item) {
              return new _this(item);
            }));
          });
        };
      })(this));
    };

    Model.findOne = function(query) {
      return defer((function(_this) {
        return function(done) {
          var col;
          col = _this.getCollection();
          return col.findOne(query).then(function(item) {
            return done(new _this(item));
          });
        };
      })(this));
    };

    function Model(params) {
      if (params == null) {
        params = {};
      }
      this.updateParams(params);
    }

    Model.prototype.updateParams = function(obj) {
      var key, val, _results;
      _results = [];
      for (key in obj) {
        val = obj[key];
        _results.push(this[key] = val);
      }
      return _results;
    };

    Model.prototype.save = function(obj) {
      if (obj == null) {
        obj = null;
      }
      if (this.disposed) {
        throw 'Already disposed';
      }
      return defer((function(_this) {
        return function(done) {
          if (obj != null) {
            _this.updateParams(obj);
          }
          if (_this.id != null) {
            return _this.constructor.update(_this.toJSON()).then(function(_arg) {
              var item;
              item = _arg[0];
              _this.updateParams(item);
              return done();
            });
          } else {
            return _this.constructor.insert(_this.toJSON()).then(function(_arg) {
              var item;
              item = _arg[0];
              _this.updateParams(item);
              return done();
            });
          }
        };
      })(this));
    };

    Model.prototype.fetch = function(id) {
      return defer((function(_this) {
        return function(done) {
          return _this.constructor.findOne({
            id: id
          }).then(function(item) {
            _this.updateParams(item);
            return done();
          });
        };
      })(this));
    };

    Model.prototype.remove = function() {
      if (!this.id) {
        throw 'Not saved';
      }
      if (this.disposed) {
        throw 'Already disposed';
      }
      return defer((function(_this) {
        return function(done) {
          return _this.constructor.remove({
            id: _this.id
          }).then(function() {
            _this.dispose();
            return done();
          });
        };
      })(this));
    };

    Model.prototype.toJSON = function() {
      var key, obj, val;
      if (this.disposed) {
        throw 'Already disposed';
      }
      obj = {};
      for (key in this) {
        val = this[key];
        if (!(val instanceof Function) && this.hasOwnProperty(key)) {
          obj[key] = val;
        }
      }
      return clone(obj);
    };

    Model.prototype.dispose = function() {
      var key;
      if (this.disposed) {
        throw 'Already disposed';
      }
      for (key in this) {
        if (this.hasOwnProperty(key)) {
          delete this[key];
        }
      }
      this.disposed = true;
      return typeof Object.freeze === "function" ? Object.freeze(this) : void 0;
    };

    return Model;

  })();

  if ((typeof define) === 'function' && (typeof define.amd) === 'object' && define.amd) {
    define(Momic);
  } else {
    window.Momic = Momic;
  }

}).call(this);

},{}],2:[function(require,module,exports){
/****
 * Grapnel.js
 * https://github.com/EngineeringMode/Grapnel.js
 *
 * @author Greg Sabia Tucker
 * @link http://artificer.io
 * @version 0.4.1
 *
 * Released under MIT License. See LICENSE.txt or http://opensource.org/licenses/MIT
*/

(function(root){

    function Grapnel(){
        "use strict";

        var self = this; // Scope reference
        this.events = {}; // Event Listeners
        this.params = []; // Named parameters
        this.state = null; // Event state
        this.version = '0.4.1'; // Version
        // Anchor
        this.anchor = {
            defaultHash : window.location.hash,
            get : function(){
                return (window.location.hash) ? window.location.hash.split('#')[1] : '';
            },
            set : function(anchor){
                window.location.hash = (!anchor) ? '' : anchor;
                return self;
            },
            clear : function(){
                return this.set(false);
            },
            reset : function(){
                return this.set(this.defaultHash);
            }
        }
        /**
         * ForEach workaround
         *
         * @param {Array} to iterate
         * @param {Function} callback
        */
        this._forEach = function(a, callback){
            if(typeof Array.prototype.forEach === 'function') return Array.prototype.forEach.call(a, callback);
            // Replicate forEach()
            return function(c, next){
                for(var i=0, n = this.length; i<n; ++i){
                    c.call(next, this[i], i, this);
                }
            }.call(a, callback);
        }
        /**
         * Fire an event listener
         *
         * @param {String} event
         * @param {Mixed} [attributes] Parameters that will be applied to event listener
         * @return self
        */
        this.trigger = function(event){
            var params = Array.prototype.slice.call(arguments, 1);
            // Call matching events
            if(this.events[event]){
                this._forEach(this.events[event], function(fn){
                    fn.apply(self, params);
                });
            }

            return this;
        }
        // Check current hash change event -- if one exists already, add it to the queue
        if(typeof window.onhashchange === 'function') this.on('hashchange', window.onhashchange);
        /**
         * Hash change event
         * TODO: increase browser compatibility. "window.onhashchange" can be supplemented in older browsers with setInterval()
        */
        window.onhashchange = function(){
            self.trigger('hashchange');
        }

        return this.trigger('initialized');
    }
    /**
     * Create a RegExp Route from a string
     * This is the heart of the router and I've made it as small as possible!
     *
     * @param {String} Path of route
     * @param {Array} Array of keys to fill
     * @param {Bool} Case sensitive comparison
     * @param {Bool} Strict mode
    */
    Grapnel.regexRoute = function(path, keys, sensitive, strict){
        if(path instanceof RegExp) return path;
        if(path instanceof Array) path = '(' + path.join('|') + ')';
        // Build route RegExp
        path = path.concat(strict ? '' : '/?')
            .replace(/\/\(/g, '(?:/')
            .replace(/\+/g, '__plus__')
            .replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g, function(_, slash, format, key, capture, optional){
                keys.push({ name : key, optional : !!optional });
                slash = slash || '';

                return '' + (optional ? '' : slash) + '(?:' + (optional ? slash : '') + (format || '') + (capture || (format && '([^/.]+?)' || '([^/]+?)')) + ')' + (optional || '');
            })
            .replace(/([\/.])/g, '\\$1')
            .replace(/__plus__/g, '(.+)')
            .replace(/\*/g, '(.*)');

        return new RegExp('^' + path + '$', sensitive ? '' : 'i');
    }
    /**
     * Add an action and handler
     *
     * @param {String|RegExp} action name
     * @param {Function} callback
     * @return self
    */
    Grapnel.prototype.get = Grapnel.prototype.add = function(route, handler){
        var self = this,
            keys = [],
            regex = Grapnel.regexRoute(route, keys);

        var invoke = function(){
            // If action is instance of RegEx, match the action
            var match = self.anchor.get().match(regex);
            // Test matches against current action
            if(match){
                // Match found
                var event = {
                    route : route,
                    value : self.anchor.get(),
                    handler : handler,
                    params : self.params,
                    regex : match,
                    propagateEvent : true,
                    previousState : self.state,
                    preventDefault : function(){
                        this.propagateEvent = false;
                    }
                }
                // Trigger main event
                self.trigger('match', event);
                // Continue?
                if(!event.propagateEvent) return self;
                // Save new state
                self.state = event;
                // Callback
                var req = { params : {}, keys : keys, matches : event.regex.slice(1) };
                // Build parameters
                self._forEach(req.matches, function(value, i){
                    var key = (keys[i] && keys[i].name) ? keys[i].name : i;
                    // Parameter key will be its key or the iteration index. This is useful if a wildcard (*) is matched
                    req.params[key] = (value) ? decodeURIComponent(value) : undefined;
                });
                // Call handler
                handler.call(self, req, event);
            }
            // Returns self
            return self;
        }
        // Invoke and add listeners -- this uses less code
        return invoke().on('initialized hashchange', invoke);
    }
    /**
     * Add an event listener
     *
     * @param {String|Array} event
     * @param {Function} callback
     * @return self
    */
    Grapnel.prototype.on = Grapnel.prototype.bind = function(event, handler){
        var self = this,
            events = event.split(' ');

        this._forEach(events, function(event){
            if(self.events[event]){
                self.events[event].push(handler);
            }else{
                self.events[event] = [handler];
            }
        });

        return this;
    }
    /**
     * Call Grapnel().router constructor for backwards compatibility
     *
     * @return {self} Router
    */
    Grapnel.Router = Grapnel.prototype.router = Grapnel;
    /**
     * Allow context
     *
     * @param {String} Route context
     * @return {Function} Adds route to context
    */
    Grapnel.prototype.context = function(context){
        var self = this;

        return function(value, callback){
            var prefix = (context.slice(-1) !== '/') ? context + '/' : context,
                pattern = prefix + value;

            return self.get.call(self, pattern, callback);
        }
    }
    /**
     * Create routes based on an object
     *
     * @param {Object} Routes
     * @return {self} Router
    */
    Grapnel.listen = function(routes){
        // Return a new Grapnel instance
        return (function(){
            // TODO: Accept multi-level routes
            for(var key in routes){
                this.get.call(this, key, routes[key]);
            }

            return this;
        }).call(new Grapnel());
    }
    // Window or module?
    if('function' === typeof root.define){
        root.define(function(require){
            return Grapnel;
        });
    }else if('object' === typeof exports){
        exports.Grapnel = Grapnel;
    }else{
        root.Grapnel = Grapnel;
    }

}).call({}, window);

},{}],3:[function(require,module,exports){
"use strict";
var Grapnel, Warden, find,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

find = function(list, fn) {
  var i, _i, _len;
  for (_i = 0, _len = list.length; _i < _len; _i++) {
    i = list[_i];
    if (fn(i)) {
      return i;
    }
  }
  return null;
};

Grapnel = require('./grapnel').Grapnel;

Warden = (function(_super) {
  __extends(Warden, _super);

  function Warden(opts) {
    var action, route;
    if (opts == null) {
      opts = {};
    }
    this.match = __bind(this.match, this);
    this.findController = __bind(this.findController, this);
    this.navigate = __bind(this.navigate, this);
    Warden.__super__.constructor.apply(this, arguments);
    if (opts.routes instanceof Function) {
      opts.routes(this.match);
    } else if (opts.routes instanceof Object) {
      for (route in routes) {
        action = routes[route];
        this.match(route, action);
      }
    }
  }

  Warden.replaceLinksToHashChange = function() {
    if (typeof $ === "undefined" || $ === null) {
      throw 'Require jQuery or zepto';
    }
    return $('body').on('click', 'a', (function(_this) {
      return function(event) {
        var href;
        event.preventDefault();
        href = $(event.target).attr('href').replace(/^(#|\/)/, '');
        return Warden.navigate(href);
      };
    })(this));
  };

  Warden.navigate = function(path) {
    path = path.replace(/^(#|\/)/, '');
    return location.href = '#' + path;
  };

  Warden.prototype.navigate = function(path) {
    return Warden.navigate(path, this.pushState);
  };

  Warden.prototype.findController = function(controllerName) {
    return require("controllers/" + controllerName + "-controller");
  };

  Warden.prototype.match = function(route, requirement) {
    var Controller, action, actionName, continueAnyway, controllerName, _ref;
    _ref = requirement.split('#'), controllerName = _ref[0], actionName = _ref[1];
    Controller = this.findController(controllerName);
    continueAnyway = function(maybePromise, next) {
      var _ref1;
      return (_ref1 = maybePromise != null ? typeof maybePromise.then === "function" ? maybePromise.then(next) : void 0 : void 0) != null ? _ref1 : next();
    };
    action = (function(_this) {
      return function(req) {
        var lastController, _ref1, _ref2;
        lastController = (_ref1 = _this.currentController) != null ? _ref1 : {};
        _this.currentController = new Controller({
          pushState: _this.pushState
        });
        _this.currentController.setLastUsings((_ref2 = lastController.usings) != null ? _ref2 : []);
        return continueAnyway(_this.currentController.beforeAction(req.params), function() {
          return continueAnyway(_this.currentController[actionName](req.params), function() {
            _this.currentController.fix();
            return continueAnyway(typeof lastController.dispose === "function" ? lastController.dispose() : void 0, function() {
              return continueAnyway(_this.currentController.afterAction(req.params), function() {
                try {
                  return window.dispatchEvent(new CustomEvent('warden:routed', {
                    req: req,
                    controllerName: controllerName,
                    actionName: actionName
                  }));
                } catch (_error) {}
              });
            });
          });
        });
      };
    })(this);
    return this.get(route, action);
  };

  return Warden;

})(Grapnel);

Warden.Controller = (function() {
  function Controller(opts) {
    this.dispose = __bind(this.dispose, this);
    this.navigate = __bind(this.navigate, this);
    this.reuse = __bind(this.reuse, this);
    var _ref;
    this.pushState = (_ref = opts != null ? opts.pushState : void 0) != null ? _ref : false;
    this.fixed = false;
    this.lastUsings = [];
    this.usings = [];
  }

  Controller.findInstance = function(usings, target) {
    var _ref, _ref1;
    return (_ref = (_ref1 = find(usings, function(using) {
      if ((typeof target) === 'string') {
        return using.key === target;
      } else if (target instanceof Function) {
        return using.instance.constructor === target;
      } else if (target instanceof Object) {
        return using.instance === target;
      }
    })) != null ? _ref1.instance : void 0) != null ? _ref : null;
  };

  Controller.prototype._createInstance = function(maybeNewable) {
    var _ref;
    if (maybeNewable instanceof Function) {
      if (!(maybeNewable.prototype.dispose instanceof Function)) {
        console.warn("This class does not have dispose", maybeNewable);
      }
      return new maybeNewable;
    } else if (maybeNewable instanceof Object) {
      if (!(maybeNewable.dispose instanceof Function)) {
        console.warn("This object does not have dispose", maybeNewable);
      }
      return maybeNewable;
    } else {
      throw new Error("Warden can't compose " + ((_ref = maybeNewable != null ? typeof maybeNewable.toString === "function" ? maybeNewable.toString() : void 0 : void 0) != null ? _ref : maybeNewable));
    }
  };

  Controller.prototype.setLastUsings = function(lastUsings) {
    this.lastUsings = lastUsings;
  };

  Controller.prototype._reuseFrom = function(usings, target, maybeNewable) {
    var instance, key, _ref;
    instance = (_ref = this.constructor.findInstance(usings, target)) != null ? _ref : this._createInstance(maybeNewable != null ? maybeNewable : target);
    key = (typeof target) === 'string' ? target : instance;
    this.usings.push({
      instance: instance,
      key: key
    });
    return instance;
  };

  Controller.prototype.reuse = function(target, maybeNewable) {
    if (maybeNewable == null) {
      maybeNewable = null;
    }
    if (this.fixed) {
      throw 'Post fixed reuse exception';
    }
    return this._reuseFrom(this.lastUsings, target, maybeNewable);
  };

  Controller.prototype.use = function(target, maybeNewable) {
    var instance;
    if (!this.fixed) {
      throw 'Pre fixed use exception';
    }
    instance = this.constructor.findInstance(this.usings, target);
    if (instance != null) {
      return instance;
    }
    return this._reuseFrom(this.usings, target, maybeNewable);
  };

  Controller.prototype.navigate = function(path) {
    return Warden.navigate(path);
  };

  Controller.prototype.fix = function() {
    var alsoUsed, used, _i, _len, _ref;
    if (this.fixed) {
      throw 'Warden.Controller#fix can be called only once';
    }
    _ref = this.lastUsings;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      used = _ref[_i];
      alsoUsed = this.constructor.findInstance(this.usings, used.key);
      if (alsoUsed == null) {
        used.instance.dispose();
      }
    }
    this.fixed = true;
    return delete this.lastUsings;
  };

  Controller.prototype.dispose = function() {
    return delete this.usings;
  };

  Controller.prototype.beforeAction = function(params) {};

  Controller.prototype.afterAction = function(params) {};

  return Controller;

})();

if ('function' === typeof window.define) {
  window.define(function(require) {
    return Warden;
  });
} else {
  window.Warden = Warden;
}


},{"./grapnel":2}],4:[function(require,module,exports){
require('./bower_components/momic/momic');

require('./bower_components/warden/src/warden');

window.mz = {};

mz.Model = Momic.Model;

mz.Router = Warden;

mz.Controller = Warden.Controller;

mz.Application = (function() {
  function Application() {}

  Application.prototype.setup = function(options) {
    return new Promise((function(_this) {
      return function(done) {
        var _ref, _ref1;
        return mz.Model.setup({
          name: (_ref = options != null ? options.name : void 0) != null ? _ref : 'app',
          collections: (_ref1 = options != null ? options.collections : void 0) != null ? _ref1 : []
        }).then(function() {
          var init;
          init = function() {
            window.removeEventListener('warden:routed');
            return done();
          };
          window.addEventListener('warden:routed', init);
          return mz.router = new mz.Router(opts.router);
        });
      };
    })(this));
  };

  return Application;

})();


},{"./bower_components/momic/momic":1,"./bower_components/warden/src/warden":3}]},{},[4])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvVXNlcnMvbWl6Y2hpLy5ub2RlYnJldy9ub2RlL3YwLjEwLjI4L2xpYi9ub2RlX21vZHVsZXMvYnJvd3NlcmlmeS9ub2RlX21vZHVsZXMvYnJvd3Nlci1wYWNrL19wcmVsdWRlLmpzIiwiL1VzZXJzL21pemNoaS9wcm9qL216L2Jvd2VyX2NvbXBvbmVudHMvbW9taWMvbW9taWMuanMiLCIvVXNlcnMvbWl6Y2hpL3Byb2ovbXovYm93ZXJfY29tcG9uZW50cy93YXJkZW4vc3JjL2dyYXBuZWwuanMiLCIvVXNlcnMvbWl6Y2hpL3Byb2ovbXovYm93ZXJfY29tcG9uZW50cy93YXJkZW4vc3JjL3dhcmRlbi5jb2ZmZWUiLCIvVXNlcnMvbWl6Y2hpL3Byb2ovbXovbXouY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3J3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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QUE7aUJBSUEsRUFBRSxDQUFDLE1BQUgsR0FBZ0IsSUFBQSxFQUFFLENBQUMsTUFBSCxDQUFVLElBQUksQ0FBQyxNQUFmLEVBTFY7UUFBQSxDQUhSLEVBRDhCO01BQUEsRUFBQTtJQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBUixFQUFqQjtFQUFBLENBQVAsQ0FBQTs7cUJBQUE7O0lBVEYsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKX12YXIgZj1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwoZi5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxmLGYuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxuKGZ1bmN0aW9uKCkge1xuICB2YXIgTW9taWMsIGFwcGx5SG9va3MsIGRlZmVyLCBkZXF1YWwsIHV1aWQsXG4gICAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSxcbiAgICBfX2luZGV4T2YgPSBbXS5pbmRleE9mIHx8IGZ1bmN0aW9uKGl0ZW0pIHsgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLmxlbmd0aDsgaSA8IGw7IGkrKykgeyBpZiAoaSBpbiB0aGlzICYmIHRoaXNbaV0gPT09IGl0ZW0pIHJldHVybiBpOyB9IHJldHVybiAtMTsgfSxcbiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuICBkZWZlciA9IGZ1bmN0aW9uKGYpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oZG9uZSwgcmVqZWN0KSB7XG4gICAgICAgIHJldHVybiBmKGRvbmUsIHJlamVjdCk7XG4gICAgICB9O1xuICAgIH0pKHRoaXMpKTtcbiAgfTtcblxuICB1dWlkID0gKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHM0O1xuICAgICAgczQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSk7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHM0KCkgKyBzNCgpICsgczQoKSArIHM0KCk7XG4gICAgfTtcbiAgfSkodGhpcyk7XG5cbiAgXG5mdW5jdGlvbiBjbG9uZShvYmopIHtcbiAgICBpZiAobnVsbCA9PSBvYmogfHwgXCJvYmplY3RcIiAhPSB0eXBlb2Ygb2JqKSByZXR1cm4gb2JqO1xuICAgIHZhciBjb3B5ID0gb2JqLmNvbnN0cnVjdG9yKCk7XG4gICAgZm9yICh2YXIgYXR0ciBpbiBvYmopIHtcbiAgICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShhdHRyKSkgY29weVthdHRyXSA9IG9ialthdHRyXTtcbiAgICB9XG4gICAgcmV0dXJuIGNvcHk7XG59XG47XG5cbiAgZGVxdWFsID0gZnVuY3Rpb24obGVmdCwgcmlnaHQpIHtcbiAgICB2YXIgaSwgaXNMZWZ0UHJpbWl0aXZlLCBpc1JpZ2h0UHJpbWl0aXZlLCBrZXksIHJlc3VsdHMsIF9yZWYsIF9yZWYxO1xuICAgIGlzTGVmdFByaW1pdGl2ZSA9IChfcmVmID0gdHlwZW9mIGxlZnQpID09PSAnc3RyaW5nJyB8fCBfcmVmID09PSAnbnVtYmVyJyB8fCBfcmVmID09PSAnYm9vbGVhbicgfHwgX3JlZiA9PT0gJ3VuZGVmaW5lZCc7XG4gICAgaXNSaWdodFByaW1pdGl2ZSA9IChfcmVmMSA9IHR5cGVvZiByaWdodCkgPT09ICdzdHJpbmcnIHx8IF9yZWYxID09PSAnbnVtYmVyJyB8fCBfcmVmMSA9PT0gJ2Jvb2xlYW4nIHx8IF9yZWYxID09PSAndW5kZWZpbmVkJztcbiAgICBpZiAoaXNMZWZ0UHJpbWl0aXZlICYmIGlzUmlnaHRQcmltaXRpdmUpIHtcbiAgICAgIHJldHVybiBsZWZ0ID09PSByaWdodDtcbiAgICB9XG4gICAgaWYgKGlzTGVmdFByaW1pdGl2ZSB8fCBpc1JpZ2h0UHJpbWl0aXZlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJlc3VsdHMgPSAoZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgX2ksIF9sZW4sIF9yZXN1bHRzLCBfcmVzdWx0czE7XG4gICAgICBpZiAobGVmdCBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gbGVmdC5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICAgIGkgPSBsZWZ0W19pXTtcbiAgICAgICAgICBfcmVzdWx0cy5wdXNoKGRlcXVhbChsZWZ0W2ldLCByaWdodFtpXSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICAgIH0gZWxzZSBpZiAobGVmdCBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgICBfcmVzdWx0czEgPSBbXTtcbiAgICAgICAgZm9yIChrZXkgaW4gbGVmdCkge1xuICAgICAgICAgIF9yZXN1bHRzMS5wdXNoKGRlcXVhbChsZWZ0W2tleV0sIHJpZ2h0W2tleV0pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX3Jlc3VsdHMxO1xuICAgICAgfVxuICAgIH0pKCk7XG4gICAgcmV0dXJuIChyZXN1bHRzLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7XG4gICAgICByZXR1cm4gaXRlbTtcbiAgICB9KSkubGVuZ3RoID09PSByZXN1bHRzLmxlbmd0aDtcbiAgfTtcblxuICBhcHBseUhvb2tzID0gZnVuY3Rpb24oaXRlbXMsIGhvb2tzKSB7XG4gICAgdmFyIGhvb2ssIGksIF9pLCBfbGVuLCBfcmVzdWx0cztcbiAgICBfcmVzdWx0cyA9IFtdO1xuICAgIGZvciAoX2kgPSAwLCBfbGVuID0gaXRlbXMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgIGkgPSBpdGVtc1tfaV07XG4gICAgICBfcmVzdWx0cy5wdXNoKChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIF9qLCBfbGVuMSwgX3Jlc3VsdHMxO1xuICAgICAgICBfcmVzdWx0czEgPSBbXTtcbiAgICAgICAgZm9yIChfaiA9IDAsIF9sZW4xID0gaG9va3MubGVuZ3RoOyBfaiA8IF9sZW4xOyBfaisrKSB7XG4gICAgICAgICAgaG9vayA9IGhvb2tzW19qXTtcbiAgICAgICAgICBfcmVzdWx0czEucHVzaChob29rKGkpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX3Jlc3VsdHMxO1xuICAgICAgfSkoKSk7XG4gICAgfVxuICAgIHJldHVybiBfcmVzdWx0cztcbiAgfTtcblxuICBNb21pYyA9IHt9O1xuXG4gIE1vbWljLmRlZXBDbG9uZSA9IGNsb25lO1xuXG4gIE1vbWljLkNvbGxlY3Rpb24gPSAoZnVuY3Rpb24oKSB7XG4gICAgQ29sbGVjdGlvbi5kZXF1YWwgPSBkZXF1YWw7XG5cbiAgICBDb2xsZWN0aW9uLnByb3RvdHlwZS5hZGRQbHVnaW4gPSBmdW5jdGlvbihfYXJnKSB7XG4gICAgICB2YXIgaW5pdGlhbGl6ZSwgcG9zdFNhdmVIb29rLCBwcmVJbnNlcnRIb29rLCBwcmVTYXZlSG9vaztcbiAgICAgIGluaXRpYWxpemUgPSBfYXJnLmluaXRpYWxpemUsIHByZUluc2VydEhvb2sgPSBfYXJnLnByZUluc2VydEhvb2ssIHRoaXMucHJlVXBkYXRlSG9vayA9IF9hcmcucHJlVXBkYXRlSG9vaywgcHJlU2F2ZUhvb2sgPSBfYXJnLnByZVNhdmVIb29rLCBwb3N0U2F2ZUhvb2sgPSBfYXJnLnBvc3RTYXZlSG9vaztcbiAgICAgIGlmIChpbml0aWFsaXplICE9IG51bGwpIHtcbiAgICAgICAgaW5pdGlhbGl6ZSh0aGlzKTtcbiAgICAgIH1cbiAgICAgIGlmIChwcmVJbnNlcnRIb29rICE9IG51bGwpIHtcbiAgICAgICAgdGhpcy5wcmVJbnNlcnRIb29rcy5wdXNoKHByZUluc2VydEhvb2spO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGVvZiBwcmVVcGRhdGVIb29rICE9PSBcInVuZGVmaW5lZFwiICYmIHByZVVwZGF0ZUhvb2sgIT09IG51bGwpIHtcbiAgICAgICAgdGhpcy5wcmVVcGRhdGVIb29rcy5wdXNoKHByZVVwZGF0ZUhvb2spO1xuICAgICAgfVxuICAgICAgaWYgKHByZVNhdmVIb29rICE9IG51bGwpIHtcbiAgICAgICAgdGhpcy5wcmVTYXZlSG9va3MucHVzaChwcmVTYXZlSG9vayk7XG4gICAgICB9XG4gICAgICBpZiAocG9zdFNhdmVIb29rICE9IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zdFNhdmVIb29rcy5wdXNoKHBvc3RTYXZlSG9vayk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIENvbGxlY3Rpb24oa2V5LCBfYXJnKSB7XG4gICAgICB2YXIgSWRBdXRvSW5zZXJ0aW9uUGx1Z2luLCBwbHVnaW4sIF9pLCBfbGVuLCBfcmVmO1xuICAgICAgdGhpcy5rZXkgPSBrZXk7XG4gICAgICB0aGlzLnNjaGVtYSA9IF9hcmcuc2NoZW1hLCB0aGlzLmhhc0luc3RhbmNlID0gX2FyZy5oYXNJbnN0YW5jZSwgdGhpcy5oYXNQZXJzaXN0ZW5jZSA9IF9hcmcuaGFzUGVyc2lzdGVuY2UsIHRoaXMuZW5kcG9pbnQgPSBfYXJnLmVuZHBvaW50LCB0aGlzLmF1dG9TYXZlID0gX2FyZy5hdXRvU2F2ZSwgdGhpcy5wbHVnaW5zID0gX2FyZy5wbHVnaW5zLCB0aGlzLmluZGV4ZXMgPSBfYXJnLmluZGV4ZXM7XG4gICAgICB0aGlzLmluaXQgPSBfX2JpbmQodGhpcy5pbml0LCB0aGlzKTtcbiAgICAgIHRoaXMucmVtb3ZlID0gX19iaW5kKHRoaXMucmVtb3ZlLCB0aGlzKTtcbiAgICAgIHRoaXMuZmluZCA9IF9fYmluZCh0aGlzLmZpbmQsIHRoaXMpO1xuICAgICAgdGhpcy5nZXRCeUlkID0gX19iaW5kKHRoaXMuZ2V0QnlJZCwgdGhpcyk7XG4gICAgICB0aGlzLmZpbmRCeUlkID0gX19iaW5kKHRoaXMuZmluZEJ5SWQsIHRoaXMpO1xuICAgICAgdGhpcy5maW5kT25lID0gX19iaW5kKHRoaXMuZmluZE9uZSwgdGhpcyk7XG4gICAgICB0aGlzLmRyb3AgPSBfX2JpbmQodGhpcy5kcm9wLCB0aGlzKTtcbiAgICAgIHRoaXMuaW5zZXJ0ID0gX19iaW5kKHRoaXMuaW5zZXJ0LCB0aGlzKTtcbiAgICAgIHRoaXMudXBkYXRlID0gX19iaW5kKHRoaXMudXBkYXRlLCB0aGlzKTtcbiAgICAgIHRoaXMuc2F2ZSA9IF9fYmluZCh0aGlzLnNhdmUsIHRoaXMpO1xuICAgICAgdGhpcy5zYXZlZCA9IF9fYmluZCh0aGlzLnNhdmVkLCB0aGlzKTtcbiAgICAgIHRoaXMubG9hZENvbnRlbnQgPSBfX2JpbmQodGhpcy5sb2FkQ29udGVudCwgdGhpcyk7XG4gICAgICB0aGlzLnVwZGF0ZUluc3RhbmNlSWZOZWVkZWQgPSBfX2JpbmQodGhpcy51cGRhdGVJbnN0YW5jZUlmTmVlZGVkLCB0aGlzKTtcbiAgICAgIHRoaXMubG9hZCA9IF9fYmluZCh0aGlzLmxvYWQsIHRoaXMpO1xuICAgICAgdGhpcy5jb3VudCA9IF9fYmluZCh0aGlzLmNvdW50LCB0aGlzKTtcbiAgICAgIHRoaXMuX3VwZGF0ZUNvdW50ID0gX19iaW5kKHRoaXMuX3VwZGF0ZUNvdW50LCB0aGlzKTtcbiAgICAgIHRoaXMudXBkYXRlSW5kZXggPSBfX2JpbmQodGhpcy51cGRhdGVJbmRleCwgdGhpcyk7XG4gICAgICB0aGlzLnJlc2V0SXRlbXNJbmRleCA9IF9fYmluZCh0aGlzLnJlc2V0SXRlbXNJbmRleCwgdGhpcyk7XG4gICAgICBpZiAodGhpcy5hdXRvU2F2ZSA9PSBudWxsKSB7XG4gICAgICAgIHRoaXMuYXV0b1NhdmUgPSB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuaGFzUGVyc2lzdGVuY2UgPT0gbnVsbCkge1xuICAgICAgICB0aGlzLmhhc1BlcnNpc3RlbmNlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmhhc0luc3RhbmNlID09IG51bGwpIHtcbiAgICAgICAgdGhpcy5oYXNJbnN0YW5jZSA9IHRydWU7XG4gICAgICB9XG4gICAgICB0aGlzLnByZUluc2VydEhvb2tzID0gW107XG4gICAgICB0aGlzLnByZVVwZGF0ZUhvb2tzID0gW107XG4gICAgICB0aGlzLnByZVNhdmVIb29rcyA9IFtdO1xuICAgICAgdGhpcy5wb3N0U2F2ZUhvb2tzID0gW107XG4gICAgICBJZEF1dG9JbnNlcnRpb25QbHVnaW4gPSB7XG4gICAgICAgIHByZUluc2VydEhvb2s6IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICByZXR1cm4gaXRlbS5pZCAhPSBudWxsID8gaXRlbS5pZCA6IGl0ZW0uaWQgPSB1dWlkKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB0aGlzLmFkZFBsdWdpbihJZEF1dG9JbnNlcnRpb25QbHVnaW4pO1xuICAgICAgaWYgKHRoaXMucGx1Z2lucyAhPSBudWxsKSB7XG4gICAgICAgIF9yZWYgPSB0aGlzLnBsdWdpbnM7XG4gICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICAgIHBsdWdpbiA9IF9yZWZbX2ldO1xuICAgICAgICAgIHRoaXMuYWRkUGx1Z2luKHBsdWdpbik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghKHRoaXMuaGFzSW5zdGFuY2UgfHwgdGhpcy5oYXNQZXJzaXN0ZW5jZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdoYXNJbnN0YW5jZSBvciBoYXNQZXJzaXN0ZW5jZSBtdXN0IGJlIHRydWUnKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2NvdW50ID0gMDtcbiAgICAgIHRoaXMuX2luc3RhbmNlID0gbnVsbDtcbiAgICAgIGlmICh0aGlzLmluZGV4ZXMgPT0gbnVsbCkge1xuICAgICAgICB0aGlzLmluZGV4ZXMgPSBbJ2lkJ107XG4gICAgICB9XG4gICAgICB0aGlzLl9pbmRleGVzRGF0YSA9IHt9O1xuICAgIH1cblxuICAgIENvbGxlY3Rpb24ucHJvdG90eXBlLmluaXRJbmRleGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgaW5kZXhOYW1lLCBfaSwgX2xlbiwgX3JlZiwgX3Jlc3VsdHM7XG4gICAgICBfcmVmID0gdGhpcy5pbmRleGVzO1xuICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICBpbmRleE5hbWUgPSBfcmVmW19pXTtcbiAgICAgICAgX3Jlc3VsdHMucHVzaCh0aGlzLnJlc2V0SXRlbXNJbmRleChpbmRleE5hbWUpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICB9O1xuXG4gICAgQ29sbGVjdGlvbi5wcm90b3R5cGUucmVzZXRJdGVtc0luZGV4ID0gZnVuY3Rpb24oaW5kZXhOYW1lKSB7XG4gICAgICB2YXIgaXRlbSwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgICAgdGhpcy5faW5kZXhlc0RhdGFbaW5kZXhOYW1lXSA9IHt9O1xuICAgICAgX3JlZiA9IHRoaXMuX2luc3RhbmNlO1xuICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICBpdGVtID0gX3JlZltfaV07XG4gICAgICAgIF9yZXN1bHRzLnB1c2godGhpcy51cGRhdGVJbmRleChpbmRleE5hbWUsIGl0ZW1baW5kZXhOYW1lXSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgIH07XG5cbiAgICBDb2xsZWN0aW9uLnByb3RvdHlwZS51cGRhdGVJbmRleCA9IGZ1bmN0aW9uKGluZGV4TmFtZSwgdmFsLCBpbmRleCkge1xuICAgICAgdmFyIGluZGV4ZXM7XG4gICAgICBpbmRleGVzID0gdGhpcy5faW5kZXhlc0RhdGFbaW5kZXhOYW1lXTtcbiAgICAgIGlmIChpbmRleGVzW3ZhbF0gIT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gaW5kZXhlc1t2YWxdLnB1c2goaW5kZXgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2luZGV4ZXNEYXRhW2luZGV4TmFtZV1bdmFsXSA9IFtpbmRleF07XG4gICAgICB9XG4gICAgfTtcblxuICAgIENvbGxlY3Rpb24ucHJvdG90eXBlLl91cGRhdGVDb3VudCA9IGZ1bmN0aW9uKF9jb3VudCkge1xuICAgICAgdGhpcy5fY291bnQgPSBfY291bnQ7XG4gICAgfTtcblxuICAgIENvbGxlY3Rpb24ucHJvdG90eXBlLmNvdW50ID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5fY291bnQ7XG4gICAgfTtcblxuICAgIENvbGxlY3Rpb24ucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBkZWZlcigoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICByZXR1cm4gbG9jYWxmb3JhZ2UuZ2V0SXRlbShfdGhpcy5rZXkpLnRoZW4oZnVuY3Rpb24oY29udGVudCkge1xuICAgICAgICAgICAgcmV0dXJuIGRvbmUoY29udGVudCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIENvbGxlY3Rpb24ucHJvdG90eXBlLnVwZGF0ZUluc3RhbmNlSWZOZWVkZWQgPSBmdW5jdGlvbihpbnN0YW5jZSkge1xuICAgICAgaWYgKHRoaXMuaGFzSW5zdGFuY2UpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlID0gaW5zdGFuY2U7XG4gICAgICB9XG4gICAgfTtcblxuICAgIENvbGxlY3Rpb24ucHJvdG90eXBlLmxvYWRDb250ZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gZGVmZXIoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihkb25lKSB7XG4gICAgICAgICAgaWYgKF90aGlzLmhhc0luc3RhbmNlICYmIF90aGlzLl9pbnN0YW5jZSkge1xuICAgICAgICAgICAgcmV0dXJuIGRvbmUoX3RoaXMuX2luc3RhbmNlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmxvYWQoKS50aGVuKGZ1bmN0aW9uKGNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGRvbmUoY29udGVudCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIENvbGxlY3Rpb24ucHJvdG90eXBlLnNhdmVkID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc2F2ZWQ7XG4gICAgfTtcblxuICAgIENvbGxlY3Rpb24ucHJvdG90eXBlLnNhdmUgPSBmdW5jdGlvbihjb250ZW50KSB7XG4gICAgICByZXR1cm4gZGVmZXIoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihkb25lKSB7XG4gICAgICAgICAgdmFyIGhvb2ssIHRvc2F2ZSwgX2ksIF9sZW4sIF9yZWY7XG4gICAgICAgICAgaWYgKCFfdGhpcy5oYXNQZXJzaXN0ZW5jZSkge1xuICAgICAgICAgICAgdGhyb3cgXCJgXCIgKyBfdGhpcy5rZXkgKyBcImAgY29sbGVjdGlvbiBkb2Vzbid0IGhhdmUgc3RvcmFnZVwiO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0b3NhdmUgPSBjb250ZW50ICE9IG51bGwgPyBjb250ZW50IDogX3RoaXMuX2luc3RhbmNlO1xuICAgICAgICAgIF9yZWYgPSBfdGhpcy5wcmVTYXZlSG9va3M7XG4gICAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7XG4gICAgICAgICAgICBob29rID0gX3JlZltfaV07XG4gICAgICAgICAgICBob29rKHRvc2F2ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBsb2NhbGZvcmFnZS5zZXRJdGVtKF90aGlzLmtleSwgdG9zYXZlKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIF9qLCBfbGVuMSwgX3JlZjE7XG4gICAgICAgICAgICBfdGhpcy51cGRhdGVJbnN0YW5jZUlmTmVlZGVkKHRvc2F2ZSk7XG4gICAgICAgICAgICBfdGhpcy5fc2F2ZWQgPSB0cnVlO1xuICAgICAgICAgICAgX3JlZjEgPSBfdGhpcy5wb3N0U2F2ZUhvb2tzO1xuICAgICAgICAgICAgZm9yIChfaiA9IDAsIF9sZW4xID0gX3JlZjEubGVuZ3RoOyBfaiA8IF9sZW4xOyBfaisrKSB7XG4gICAgICAgICAgICAgIGhvb2sgPSBfcmVmMVtfal07XG4gICAgICAgICAgICAgIGhvb2sodG9zYXZlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkb25lKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIENvbGxlY3Rpb24ucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKG9iaikge1xuICAgICAgcmV0dXJuIGRlZmVyKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICAgIHZhciBhcnJheTtcbiAgICAgICAgICBhcnJheSA9IG9iai5sZW5ndGggIT0gbnVsbCA/IG9iaiA6IFtvYmpdO1xuICAgICAgICAgIHJldHVybiBfdGhpcy5sb2FkQ29udGVudCgpLnRoZW4oZnVuY3Rpb24oY29udGVudCkge1xuICAgICAgICAgICAgdmFyIGMsIGl0ZW0sIGtleSwgbiwgdmFsLCBfaSwgX2osIF9sZW4sIF9sZW4xO1xuICAgICAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBhcnJheS5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykge1xuICAgICAgICAgICAgICBpdGVtID0gYXJyYXlbX2ldO1xuICAgICAgICAgICAgICBmb3IgKG4gPSBfaiA9IDAsIF9sZW4xID0gY29udGVudC5sZW5ndGg7IF9qIDwgX2xlbjE7IG4gPSArK19qKSB7XG4gICAgICAgICAgICAgICAgYyA9IGNvbnRlbnRbbl07XG4gICAgICAgICAgICAgICAgaWYgKGMuaWQgPT09IGl0ZW0uaWQpIHtcbiAgICAgICAgICAgICAgICAgIGZvciAoa2V5IGluIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsID0gaXRlbVtrZXldO1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50W25dW2tleV0gPSB2YWw7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFwcGx5SG9va3MoY29udGVudCwgX3RoaXMucHJlVXBkYXRlSG9va3MpO1xuICAgICAgICAgICAgX3RoaXMudXBkYXRlSW5zdGFuY2VJZk5lZWRlZChjb250ZW50KTtcbiAgICAgICAgICAgIGlmIChfdGhpcy5hdXRvU2F2ZSkge1xuICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuc2F2ZShjb250ZW50KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkb25lKGNsb25lKGFycmF5KSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgX3RoaXMuX3NhdmVkID0gZmFsc2U7XG4gICAgICAgICAgICAgIHJldHVybiBkb25lKGNsb25lKGFycmF5KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIENvbGxlY3Rpb24ucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uKG9iaikge1xuICAgICAgcmV0dXJuIGRlZmVyKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICAgIHZhciBhcnJheSwgcmV0O1xuICAgICAgICAgIGFycmF5ID0gb2JqLmxlbmd0aCA/IG9iai5tYXAoZnVuY3Rpb24oaSkge1xuICAgICAgICAgICAgdmFyIHJldDtcbiAgICAgICAgICAgIHJldCA9IGNsb25lKGkpO1xuICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICB9KSA6IChyZXQgPSBjbG9uZShvYmopLCBbcmV0XSk7XG4gICAgICAgICAgYXBwbHlIb29rcyhhcnJheSwgX3RoaXMucHJlSW5zZXJ0SG9va3MpO1xuICAgICAgICAgIHJldHVybiBfdGhpcy5sb2FkQ29udGVudCgpLnRoZW4oZnVuY3Rpb24oY29udGVudCkge1xuICAgICAgICAgICAgdmFyIGJlZm9yZUluZGV4TGVuZ3RoLCBpLCBuLCBfaSwgX2osIF9sZW4sIF9sZW4xO1xuICAgICAgICAgICAgYmVmb3JlSW5kZXhMZW5ndGggPSBjb250ZW50Lmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gYXJyYXkubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgICAgICAgaSA9IGFycmF5W19pXTtcbiAgICAgICAgICAgICAgY29udGVudC5wdXNoKGkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChuID0gX2ogPSAwLCBfbGVuMSA9IGFycmF5Lmxlbmd0aDsgX2ogPCBfbGVuMTsgbiA9ICsrX2opIHtcbiAgICAgICAgICAgICAgaSA9IGFycmF5W25dO1xuICAgICAgICAgICAgICBfdGhpcy51cGRhdGVJbmRleCgnaWQnLCBpLmlkLCBiZWZvcmVJbmRleExlbmd0aCArIG4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3RoaXMuX3VwZGF0ZUNvdW50KGNvbnRlbnQubGVuZ3RoKTtcbiAgICAgICAgICAgIGlmIChfdGhpcy5hdXRvU2F2ZSkge1xuICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuc2F2ZSgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLmhhc0luc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgICBfdGhpcy5faW5zdGFuY2UgPSBjb250ZW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZG9uZShjbG9uZShhcnJheSkpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIF90aGlzLl9zYXZlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICBpZiAoX3RoaXMuaGFzSW5zdGFuY2UpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5faW5zdGFuY2UgPSBjb250ZW50O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiBkb25lKGNsb25lKGFycmF5KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIENvbGxlY3Rpb24ucHJvdG90eXBlLmRyb3AgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBkZWZlcigoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICByZXR1cm4gbG9jYWxmb3JhZ2Uuc2V0SXRlbShfdGhpcy5rZXksIFtdKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIGRvbmUoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgQ29sbGVjdGlvbi5wcm90b3R5cGUuZmluZE9uZSA9IGZ1bmN0aW9uKGZ1bmNfb3Jfb2JqKSB7XG4gICAgICByZXR1cm4gZGVmZXIoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihkb25lKSB7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLmZpbmQoZnVuY19vcl9vYmopLnRoZW4oZnVuY3Rpb24oX2FyZykge1xuICAgICAgICAgICAgdmFyIGZpcnN0O1xuICAgICAgICAgICAgZmlyc3QgPSBfYXJnWzBdO1xuICAgICAgICAgICAgcmV0dXJuIGRvbmUoY2xvbmUoZmlyc3QpKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgQ29sbGVjdGlvbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbihpZCkge1xuICAgICAgcmV0dXJuIGRlZmVyKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICAgIHZhciBpbmRleDtcbiAgICAgICAgICBpZiAoIV90aGlzLmhhc0luc3RhbmNlKSB7XG4gICAgICAgICAgICB0aHJvdyAnbmVlZCBoYXNJbnN0YW5jZSc7XG4gICAgICAgICAgfVxuICAgICAgICAgIGluZGV4ID0gX3RoaXMuX2luZGV4ZXNEYXRhWydpZCddW2lkXVswXTtcbiAgICAgICAgICByZXR1cm4gZG9uZShjbG9uZShfdGhpcy5faW5zdGFuY2VbaW5kZXhdKSk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIENvbGxlY3Rpb24ucHJvdG90eXBlLmdldEJ5SWQgPSBmdW5jdGlvbihpZCkge1xuICAgICAgdmFyIGluZGV4O1xuICAgICAgaWYgKCF0aGlzLmhhc0luc3RhbmNlKSB7XG4gICAgICAgIHRocm93ICduZWVkIGhhc0luc3RhbmNlJztcbiAgICAgIH1cbiAgICAgIGluZGV4ID0gdGhpcy5faW5kZXhlc0RhdGFbJ2lkJ11baWRdWzBdO1xuICAgICAgcmV0dXJuIGNsb25lKHRoaXMuX2luc3RhbmNlW2luZGV4XSk7XG4gICAgfTtcblxuICAgIENvbGxlY3Rpb24ucHJvdG90eXBlLmZpbmQgPSBmdW5jdGlvbihmdW5jX29yX29iaikge1xuICAgICAgaWYgKGZ1bmNfb3Jfb2JqID09IG51bGwpIHtcbiAgICAgICAgZnVuY19vcl9vYmogPSBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGRlZmVyKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICAgIHJldHVybiBfdGhpcy5sb2FkQ29udGVudCgpLnRoZW4oZnVuY3Rpb24oY29udGVudCkge1xuICAgICAgICAgICAgdmFyIGZ1bmMsIHF1ZXJ5T2JqLCByZXN1bHRzO1xuICAgICAgICAgICAgcmVzdWx0cyA9IGZ1bmNfb3Jfb2JqID09IG51bGwgPyBjb250ZW50IDogKGZ1bmMgPSBmdW5jX29yX29iaikgaW5zdGFuY2VvZiBGdW5jdGlvbiA/IGNvbnRlbnQuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZ1bmMoaXRlbSk7XG4gICAgICAgICAgICB9KSA6IChxdWVyeU9iaiA9IGZ1bmNfb3Jfb2JqKSBpbnN0YW5jZW9mIE9iamVjdCA/IGNvbnRlbnQuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGRlcXVhbChxdWVyeU9iaiwgaXRlbSk7XG4gICAgICAgICAgICB9KSA6IHZvaWQgMDtcbiAgICAgICAgICAgIHJldHVybiBkb25lKGNsb25lKHJlc3VsdHMpKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgQ29sbGVjdGlvbi5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oZnVuY19vcl9vYmopIHtcbiAgICAgIHZhciBkO1xuICAgICAgcmV0dXJuIGQgPSBkZWZlcigoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICB2YXIgYywgbG9hZGluZztcbiAgICAgICAgICBjID0gbnVsbDtcbiAgICAgICAgICBsb2FkaW5nID0gZGVmZXIoZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmxvYWRDb250ZW50KCkudGhlbihmdW5jdGlvbihjb250ZW50KSB7XG4gICAgICAgICAgICAgIGMgPSBjb250ZW50O1xuICAgICAgICAgICAgICByZXR1cm4gZG9uZShjb250ZW50KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBsb2FkaW5nLnRoZW4oZnVuY3Rpb24oY29udGVudCkge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmZpbmQoZnVuY19vcl9vYmopLnRoZW4oZnVuY3Rpb24odG9yZW1vdmUpIHtcbiAgICAgICAgICAgICAgdmFyIHJlbW92ZV9pZHM7XG4gICAgICAgICAgICAgIHJlbW92ZV9pZHMgPSB0b3JlbW92ZS5tYXAoZnVuY3Rpb24oaSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpLmlkO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgY29udGVudCA9IGNvbnRlbnQuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgX3JlZjtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3JlZiA9IGl0ZW0uaWQsIF9faW5kZXhPZi5jYWxsKHJlbW92ZV9pZHMsIF9yZWYpIDwgMDtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHJldHVybiBfdGhpcy5zYXZlKGNvbnRlbnQpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX3VwZGF0ZUNvdW50KGNvbnRlbnQubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZG9uZSgpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgIH07XG5cbiAgICBDb2xsZWN0aW9uLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gZGVmZXIoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihkb25lKSB7XG4gICAgICAgICAgcmV0dXJuIGxvY2FsZm9yYWdlLmdldEl0ZW0oX3RoaXMua2V5LCBmdW5jdGlvbihjb250ZW50KSB7XG4gICAgICAgICAgICBpZiAoY29udGVudCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgIGNvbnRlbnQgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfdGhpcy5oYXNJbnN0YW5jZSkge1xuICAgICAgICAgICAgICBfdGhpcy5faW5zdGFuY2UgPSBjb250ZW50O1xuICAgICAgICAgICAgICBfdGhpcy5pbml0SW5kZXhlcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKF90aGlzLmhhc1BlcnNpc3RlbmNlKSB7XG4gICAgICAgICAgICAgIHJldHVybiBfdGhpcy5zYXZlKGNvbnRlbnQpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRvbmUoKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBfdGhpcy5fdXBkYXRlQ291bnQoY29udGVudC5sZW5ndGgpO1xuICAgICAgICAgICAgICByZXR1cm4gZG9uZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgIH07XG5cbiAgICByZXR1cm4gQ29sbGVjdGlvbjtcblxuICB9KSgpO1xuXG4gIE1vbWljLkRCID0gKGZ1bmN0aW9uKCkge1xuICAgIERCLnByb3RvdHlwZS5jb2xsZWN0aW9uS2V5ID0gZnVuY3Rpb24oY29sbGVjdGlvbk5hbWUpIHtcbiAgICAgIHJldHVybiB0aGlzLnByZWZpeCArICdfJyArIGNvbGxlY3Rpb25OYW1lO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBEQihvcHRzKSB7XG4gICAgICB0aGlzLmluaXQgPSBfX2JpbmQodGhpcy5pbml0LCB0aGlzKTtcbiAgICAgIHRoaXMuY29sbGVjdGlvbktleSA9IF9fYmluZCh0aGlzLmNvbGxlY3Rpb25LZXksIHRoaXMpO1xuICAgICAgdmFyIGNvbE9wdHMsIGtleSwgX3JlZjtcbiAgICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMucHJlZml4ID0gKG9wdHMgIT0gbnVsbCA/IG9wdHMubmFtZSA6IHZvaWQgMCkgfHwgJyc7XG4gICAgICB0aGlzLnN0b3JhZ2UgPSAob3B0cyAhPSBudWxsID8gb3B0cy5zdG9yYWdlIDogdm9pZCAwKSB8fCAnbG9jYWxmb3JhZ2UnO1xuICAgICAgdGhpcy5jb2xsZWN0aW9ucyA9IFtdO1xuICAgICAgX3JlZiA9IG9wdHMgIT0gbnVsbCA/IG9wdHMuY29sbGVjdGlvbnMgOiB2b2lkIDA7XG4gICAgICBmb3IgKGtleSBpbiBfcmVmKSB7XG4gICAgICAgIGNvbE9wdHMgPSBfcmVmW2tleV07XG4gICAgICAgIHRoaXMuYWRkQ29sbGVjdGlvbihrZXksIGNvbE9wdHMpO1xuICAgICAgfVxuICAgIH1cblxuICAgIERCLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gZGVmZXIoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihkb25lKSB7XG4gICAgICAgICAgdmFyIGluaXRzO1xuICAgICAgICAgIGluaXRzID0gX3RoaXMuY29sbGVjdGlvbnMubWFwKGZ1bmN0aW9uKGNvbCkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbC5pbml0KCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKGluaXRzKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgX3RoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIGRvbmUoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgREIucHJvdG90eXBlLmFkZENvbGxlY3Rpb24gPSBmdW5jdGlvbihrZXksIGNvbE9wdHMpIHtcbiAgICAgIGlmIChrZXkgPT09ICdpbml0aWFsaXplZCcgfHwga2V5ID09PSAncHJlZml4JyB8fCBrZXkgPT09ICdzdG9yYWdlJyB8fCBrZXkgPT09ICdpbml0JyB8fCBrZXkgPT09ICdjb2xsZWN0aW9uS2V5JyB8fCBrZXkgPT09ICdhZGRDb2xsZWN0aW9uJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCInXCIgKyBrZXkgKyBcIicgaXMgcmVzZXJ2ZWQgd29yZFwiKTtcbiAgICAgIH1cbiAgICAgIGlmIChjb2xPcHRzLnN0b3JhZ2UgPT0gbnVsbCkge1xuICAgICAgICBjb2xPcHRzLnN0b3JhZ2UgPSB0aGlzLnN0b3JhZ2U7XG4gICAgICB9XG4gICAgICB0aGlzW2tleV0gPSBuZXcgTW9taWMuQ29sbGVjdGlvbih0aGlzLmNvbGxlY3Rpb25LZXkoa2V5KSwgY29sT3B0cyk7XG4gICAgICB0aGlzLmNvbGxlY3Rpb25zLnB1c2godGhpc1trZXldKTtcbiAgICAgIGlmICh0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICAgIHJldHVybiBkZWZlcigoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzW2tleV0uaW5pdCgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHJldHVybiBkb25lKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KSh0aGlzKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpc1trZXldO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4gREI7XG5cbiAgfSkoKTtcblxuICBNb21pYy5Nb2RlbCA9IChmdW5jdGlvbigpIHtcbiAgICBNb2RlbC5zZXR1cCA9IGZ1bmN0aW9uKG9wdHMpIHtcbiAgICAgIHJldHVybiBkZWZlcihmdW5jdGlvbihkb25lKSB7XG4gICAgICAgIHZhciBkYjtcbiAgICAgICAgZGIgPSBuZXcgTW9taWMuREIob3B0cyk7XG4gICAgICAgIHJldHVybiBkYi5pbml0KCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gZG9uZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBNb2RlbC5zZXREQiA9IGZ1bmN0aW9uKGRiKSB7XG4gICAgICByZXR1cm4gTW9kZWwuX2RiID0gZGI7XG4gICAgfTtcblxuICAgIE1vZGVsLmdldERCID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gTW9kZWwuX2RiO1xuICAgIH07XG5cbiAgICBNb2RlbC5jb3VudCA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29sbGVjdGlvbigpLmNvdW50KCk7XG4gICAgfTtcblxuICAgIE1vZGVsLmV4dGVuZCA9IGZ1bmN0aW9uKG9iaikge1xuICAgICAgdmFyIGNscywga2V5LCB2YWw7XG4gICAgICBjbHMgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gICAgICAgIF9fZXh0ZW5kcyhfQ2xhc3MsIF9zdXBlcik7XG5cbiAgICAgICAgZnVuY3Rpb24gX0NsYXNzKCkge1xuICAgICAgICAgIHJldHVybiBfQ2xhc3MuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gX0NsYXNzO1xuXG4gICAgICB9KSh0aGlzKTtcbiAgICAgIGZvciAoa2V5IGluIG9iaikge1xuICAgICAgICB2YWwgPSBvYmpba2V5XTtcbiAgICAgICAgY2xzLnByb3RvdHlwZVtrZXldID0gdmFsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNscztcbiAgICB9O1xuXG4gICAgTW9kZWwuZ2V0Q29sbGVjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGRiO1xuICAgICAgaWYgKCF0aGlzLnByb3RvdHlwZS5rZXkpIHtcbiAgICAgICAgdGhyb3cgJ05lZWQga2V5JztcbiAgICAgIH1cbiAgICAgIGRiID0gdGhpcy5nZXREQigpO1xuICAgICAgcmV0dXJuIGRiW3RoaXMucHJvdG90eXBlLmtleV07XG4gICAgfTtcblxuICAgIE1vZGVsLmZpbmQgPSBmdW5jdGlvbihxdWVyeSkge1xuICAgICAgcmV0dXJuIGRlZmVyKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICAgIHZhciBjb2w7XG4gICAgICAgICAgY29sID0gX3RoaXMuZ2V0Q29sbGVjdGlvbigpO1xuICAgICAgICAgIHJldHVybiBjb2wuZmluZChxdWVyeSkudGhlbihmdW5jdGlvbihpdGVtcykge1xuICAgICAgICAgICAgcmV0dXJuIGRvbmUoaXRlbXMubWFwKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBfdGhpcyhpdGVtKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgTW9kZWwucmVtb3ZlID0gZnVuY3Rpb24ocXVlcnkpIHtcbiAgICAgIHJldHVybiBkZWZlcigoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICB2YXIgY29sO1xuICAgICAgICAgIGNvbCA9IF90aGlzLmdldENvbGxlY3Rpb24oKTtcbiAgICAgICAgICByZXR1cm4gY29sLnJlbW92ZShxdWVyeSkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBkb25lKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIE1vZGVsLnVwZGF0ZSA9IGZ1bmN0aW9uKG9iaikge1xuICAgICAgcmV0dXJuIGRlZmVyKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZG9uZSkge1xuICAgICAgICAgIHZhciBjb2w7XG4gICAgICAgICAgY29sID0gX3RoaXMuZ2V0Q29sbGVjdGlvbigpO1xuICAgICAgICAgIHJldHVybiBjb2wudXBkYXRlKG9iaikudGhlbihmdW5jdGlvbih1cGRhdGVkSXRlbXMpIHtcbiAgICAgICAgICAgIHJldHVybiBkb25lKHVwZGF0ZWRJdGVtcy5tYXAoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICByZXR1cm4gbmV3IF90aGlzKGl0ZW0pO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgIH07XG5cbiAgICBNb2RlbC5pbnNlcnQgPSBmdW5jdGlvbihvYmopIHtcbiAgICAgIHJldHVybiBkZWZlcigoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICB2YXIgY29sO1xuICAgICAgICAgIGNvbCA9IF90aGlzLmdldENvbGxlY3Rpb24oKTtcbiAgICAgICAgICByZXR1cm4gY29sLmluc2VydChvYmopLnRoZW4oZnVuY3Rpb24oaW5zZXJ0ZWRJdGVtcykge1xuICAgICAgICAgICAgcmV0dXJuIGRvbmUoaW5zZXJ0ZWRJdGVtcy5tYXAoZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICByZXR1cm4gbmV3IF90aGlzKGl0ZW0pO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgIH07XG5cbiAgICBNb2RlbC5maW5kT25lID0gZnVuY3Rpb24ocXVlcnkpIHtcbiAgICAgIHJldHVybiBkZWZlcigoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICB2YXIgY29sO1xuICAgICAgICAgIGNvbCA9IF90aGlzLmdldENvbGxlY3Rpb24oKTtcbiAgICAgICAgICByZXR1cm4gY29sLmZpbmRPbmUocXVlcnkpLnRoZW4oZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgcmV0dXJuIGRvbmUobmV3IF90aGlzKGl0ZW0pKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gTW9kZWwocGFyYW1zKSB7XG4gICAgICBpZiAocGFyYW1zID09IG51bGwpIHtcbiAgICAgICAgcGFyYW1zID0ge307XG4gICAgICB9XG4gICAgICB0aGlzLnVwZGF0ZVBhcmFtcyhwYXJhbXMpO1xuICAgIH1cblxuICAgIE1vZGVsLnByb3RvdHlwZS51cGRhdGVQYXJhbXMgPSBmdW5jdGlvbihvYmopIHtcbiAgICAgIHZhciBrZXksIHZhbCwgX3Jlc3VsdHM7XG4gICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgZm9yIChrZXkgaW4gb2JqKSB7XG4gICAgICAgIHZhbCA9IG9ialtrZXldO1xuICAgICAgICBfcmVzdWx0cy5wdXNoKHRoaXNba2V5XSA9IHZhbCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgfTtcblxuICAgIE1vZGVsLnByb3RvdHlwZS5zYXZlID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgICBpZiAob2JqID09IG51bGwpIHtcbiAgICAgICAgb2JqID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmRpc3Bvc2VkKSB7XG4gICAgICAgIHRocm93ICdBbHJlYWR5IGRpc3Bvc2VkJztcbiAgICAgIH1cbiAgICAgIHJldHVybiBkZWZlcigoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICBpZiAob2JqICE9IG51bGwpIHtcbiAgICAgICAgICAgIF90aGlzLnVwZGF0ZVBhcmFtcyhvYmopO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoX3RoaXMuaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmNvbnN0cnVjdG9yLnVwZGF0ZShfdGhpcy50b0pTT04oKSkudGhlbihmdW5jdGlvbihfYXJnKSB7XG4gICAgICAgICAgICAgIHZhciBpdGVtO1xuICAgICAgICAgICAgICBpdGVtID0gX2FyZ1swXTtcbiAgICAgICAgICAgICAgX3RoaXMudXBkYXRlUGFyYW1zKGl0ZW0pO1xuICAgICAgICAgICAgICByZXR1cm4gZG9uZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5jb25zdHJ1Y3Rvci5pbnNlcnQoX3RoaXMudG9KU09OKCkpLnRoZW4oZnVuY3Rpb24oX2FyZykge1xuICAgICAgICAgICAgICB2YXIgaXRlbTtcbiAgICAgICAgICAgICAgaXRlbSA9IF9hcmdbMF07XG4gICAgICAgICAgICAgIF90aGlzLnVwZGF0ZVBhcmFtcyhpdGVtKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGRvbmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgTW9kZWwucHJvdG90eXBlLmZldGNoID0gZnVuY3Rpb24oaWQpIHtcbiAgICAgIHJldHVybiBkZWZlcigoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICByZXR1cm4gX3RoaXMuY29uc3RydWN0b3IuZmluZE9uZSh7XG4gICAgICAgICAgICBpZDogaWRcbiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgIF90aGlzLnVwZGF0ZVBhcmFtcyhpdGVtKTtcbiAgICAgICAgICAgIHJldHVybiBkb25lKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIE1vZGVsLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmICghdGhpcy5pZCkge1xuICAgICAgICB0aHJvdyAnTm90IHNhdmVkJztcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmRpc3Bvc2VkKSB7XG4gICAgICAgIHRocm93ICdBbHJlYWR5IGRpc3Bvc2VkJztcbiAgICAgIH1cbiAgICAgIHJldHVybiBkZWZlcigoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGRvbmUpIHtcbiAgICAgICAgICByZXR1cm4gX3RoaXMuY29uc3RydWN0b3IucmVtb3ZlKHtcbiAgICAgICAgICAgIGlkOiBfdGhpcy5pZFxuICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBfdGhpcy5kaXNwb3NlKCk7XG4gICAgICAgICAgICByZXR1cm4gZG9uZSgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpO1xuICAgIH07XG5cbiAgICBNb2RlbC5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIga2V5LCBvYmosIHZhbDtcbiAgICAgIGlmICh0aGlzLmRpc3Bvc2VkKSB7XG4gICAgICAgIHRocm93ICdBbHJlYWR5IGRpc3Bvc2VkJztcbiAgICAgIH1cbiAgICAgIG9iaiA9IHt9O1xuICAgICAgZm9yIChrZXkgaW4gdGhpcykge1xuICAgICAgICB2YWwgPSB0aGlzW2tleV07XG4gICAgICAgIGlmICghKHZhbCBpbnN0YW5jZW9mIEZ1bmN0aW9uKSAmJiB0aGlzLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICBvYmpba2V5XSA9IHZhbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNsb25lKG9iaik7XG4gICAgfTtcblxuICAgIE1vZGVsLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIga2V5O1xuICAgICAgaWYgKHRoaXMuZGlzcG9zZWQpIHtcbiAgICAgICAgdGhyb3cgJ0FscmVhZHkgZGlzcG9zZWQnO1xuICAgICAgfVxuICAgICAgZm9yIChrZXkgaW4gdGhpcykge1xuICAgICAgICBpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgZGVsZXRlIHRoaXNba2V5XTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5kaXNwb3NlZCA9IHRydWU7XG4gICAgICByZXR1cm4gdHlwZW9mIE9iamVjdC5mcmVlemUgPT09IFwiZnVuY3Rpb25cIiA/IE9iamVjdC5mcmVlemUodGhpcykgOiB2b2lkIDA7XG4gICAgfTtcblxuICAgIHJldHVybiBNb2RlbDtcblxuICB9KSgpO1xuXG4gIGlmICgodHlwZW9mIGRlZmluZSkgPT09ICdmdW5jdGlvbicgJiYgKHR5cGVvZiBkZWZpbmUuYW1kKSA9PT0gJ29iamVjdCcgJiYgZGVmaW5lLmFtZCkge1xuICAgIGRlZmluZShNb21pYyk7XG4gIH0gZWxzZSB7XG4gICAgd2luZG93Lk1vbWljID0gTW9taWM7XG4gIH1cblxufSkuY2FsbCh0aGlzKTtcbiIsIi8qKioqXG4gKiBHcmFwbmVsLmpzXG4gKiBodHRwczovL2dpdGh1Yi5jb20vRW5naW5lZXJpbmdNb2RlL0dyYXBuZWwuanNcbiAqXG4gKiBAYXV0aG9yIEdyZWcgU2FiaWEgVHVja2VyXG4gKiBAbGluayBodHRwOi8vYXJ0aWZpY2VyLmlvXG4gKiBAdmVyc2lvbiAwLjQuMVxuICpcbiAqIFJlbGVhc2VkIHVuZGVyIE1JVCBMaWNlbnNlLiBTZWUgTElDRU5TRS50eHQgb3IgaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL01JVFxuKi9cblxuKGZ1bmN0aW9uKHJvb3Qpe1xuXG4gICAgZnVuY3Rpb24gR3JhcG5lbCgpe1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7IC8vIFNjb3BlIHJlZmVyZW5jZVxuICAgICAgICB0aGlzLmV2ZW50cyA9IHt9OyAvLyBFdmVudCBMaXN0ZW5lcnNcbiAgICAgICAgdGhpcy5wYXJhbXMgPSBbXTsgLy8gTmFtZWQgcGFyYW1ldGVyc1xuICAgICAgICB0aGlzLnN0YXRlID0gbnVsbDsgLy8gRXZlbnQgc3RhdGVcbiAgICAgICAgdGhpcy52ZXJzaW9uID0gJzAuNC4xJzsgLy8gVmVyc2lvblxuICAgICAgICAvLyBBbmNob3JcbiAgICAgICAgdGhpcy5hbmNob3IgPSB7XG4gICAgICAgICAgICBkZWZhdWx0SGFzaCA6IHdpbmRvdy5sb2NhdGlvbi5oYXNoLFxuICAgICAgICAgICAgZ2V0IDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHdpbmRvdy5sb2NhdGlvbi5oYXNoKSA/IHdpbmRvdy5sb2NhdGlvbi5oYXNoLnNwbGl0KCcjJylbMV0gOiAnJztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXQgOiBmdW5jdGlvbihhbmNob3Ipe1xuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gKCFhbmNob3IpID8gJycgOiBhbmNob3I7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbGY7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2xlYXIgOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNldChmYWxzZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVzZXQgOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNldCh0aGlzLmRlZmF1bHRIYXNoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogRm9yRWFjaCB3b3JrYXJvdW5kXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IHRvIGl0ZXJhdGVcbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2tcbiAgICAgICAgKi9cbiAgICAgICAgdGhpcy5fZm9yRWFjaCA9IGZ1bmN0aW9uKGEsIGNhbGxiYWNrKXtcbiAgICAgICAgICAgIGlmKHR5cGVvZiBBcnJheS5wcm90b3R5cGUuZm9yRWFjaCA9PT0gJ2Z1bmN0aW9uJykgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoYSwgY2FsbGJhY2spO1xuICAgICAgICAgICAgLy8gUmVwbGljYXRlIGZvckVhY2goKVxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGMsIG5leHQpe1xuICAgICAgICAgICAgICAgIGZvcih2YXIgaT0wLCBuID0gdGhpcy5sZW5ndGg7IGk8bjsgKytpKXtcbiAgICAgICAgICAgICAgICAgICAgYy5jYWxsKG5leHQsIHRoaXNbaV0sIGksIHRoaXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0uY2FsbChhLCBjYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmUgYW4gZXZlbnQgbGlzdGVuZXJcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50XG4gICAgICAgICAqIEBwYXJhbSB7TWl4ZWR9IFthdHRyaWJ1dGVzXSBQYXJhbWV0ZXJzIHRoYXQgd2lsbCBiZSBhcHBsaWVkIHRvIGV2ZW50IGxpc3RlbmVyXG4gICAgICAgICAqIEByZXR1cm4gc2VsZlxuICAgICAgICAqL1xuICAgICAgICB0aGlzLnRyaWdnZXIgPSBmdW5jdGlvbihldmVudCl7XG4gICAgICAgICAgICB2YXIgcGFyYW1zID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgICAgICAgICAgIC8vIENhbGwgbWF0Y2hpbmcgZXZlbnRzXG4gICAgICAgICAgICBpZih0aGlzLmV2ZW50c1tldmVudF0pe1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZvckVhY2godGhpcy5ldmVudHNbZXZlbnRdLCBmdW5jdGlvbihmbil7XG4gICAgICAgICAgICAgICAgICAgIGZuLmFwcGx5KHNlbGYsIHBhcmFtcyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoZWNrIGN1cnJlbnQgaGFzaCBjaGFuZ2UgZXZlbnQgLS0gaWYgb25lIGV4aXN0cyBhbHJlYWR5LCBhZGQgaXQgdG8gdGhlIHF1ZXVlXG4gICAgICAgIGlmKHR5cGVvZiB3aW5kb3cub25oYXNoY2hhbmdlID09PSAnZnVuY3Rpb24nKSB0aGlzLm9uKCdoYXNoY2hhbmdlJywgd2luZG93Lm9uaGFzaGNoYW5nZSk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYXNoIGNoYW5nZSBldmVudFxuICAgICAgICAgKiBUT0RPOiBpbmNyZWFzZSBicm93c2VyIGNvbXBhdGliaWxpdHkuIFwid2luZG93Lm9uaGFzaGNoYW5nZVwiIGNhbiBiZSBzdXBwbGVtZW50ZWQgaW4gb2xkZXIgYnJvd3NlcnMgd2l0aCBzZXRJbnRlcnZhbCgpXG4gICAgICAgICovXG4gICAgICAgIHdpbmRvdy5vbmhhc2hjaGFuZ2UgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgc2VsZi50cmlnZ2VyKCdoYXNoY2hhbmdlJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy50cmlnZ2VyKCdpbml0aWFsaXplZCcpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBSZWdFeHAgUm91dGUgZnJvbSBhIHN0cmluZ1xuICAgICAqIFRoaXMgaXMgdGhlIGhlYXJ0IG9mIHRoZSByb3V0ZXIgYW5kIEkndmUgbWFkZSBpdCBhcyBzbWFsbCBhcyBwb3NzaWJsZSFcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBQYXRoIG9mIHJvdXRlXG4gICAgICogQHBhcmFtIHtBcnJheX0gQXJyYXkgb2Yga2V5cyB0byBmaWxsXG4gICAgICogQHBhcmFtIHtCb29sfSBDYXNlIHNlbnNpdGl2ZSBjb21wYXJpc29uXG4gICAgICogQHBhcmFtIHtCb29sfSBTdHJpY3QgbW9kZVxuICAgICovXG4gICAgR3JhcG5lbC5yZWdleFJvdXRlID0gZnVuY3Rpb24ocGF0aCwga2V5cywgc2Vuc2l0aXZlLCBzdHJpY3Qpe1xuICAgICAgICBpZihwYXRoIGluc3RhbmNlb2YgUmVnRXhwKSByZXR1cm4gcGF0aDtcbiAgICAgICAgaWYocGF0aCBpbnN0YW5jZW9mIEFycmF5KSBwYXRoID0gJygnICsgcGF0aC5qb2luKCd8JykgKyAnKSc7XG4gICAgICAgIC8vIEJ1aWxkIHJvdXRlIFJlZ0V4cFxuICAgICAgICBwYXRoID0gcGF0aC5jb25jYXQoc3RyaWN0ID8gJycgOiAnLz8nKVxuICAgICAgICAgICAgLnJlcGxhY2UoL1xcL1xcKC9nLCAnKD86LycpXG4gICAgICAgICAgICAucmVwbGFjZSgvXFwrL2csICdfX3BsdXNfXycpXG4gICAgICAgICAgICAucmVwbGFjZSgvKFxcLyk/KFxcLik/OihcXHcrKSg/OihcXCguKj9cXCkpKT8oXFw/KT8vZywgZnVuY3Rpb24oXywgc2xhc2gsIGZvcm1hdCwga2V5LCBjYXB0dXJlLCBvcHRpb25hbCl7XG4gICAgICAgICAgICAgICAga2V5cy5wdXNoKHsgbmFtZSA6IGtleSwgb3B0aW9uYWwgOiAhIW9wdGlvbmFsIH0pO1xuICAgICAgICAgICAgICAgIHNsYXNoID0gc2xhc2ggfHwgJyc7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gJycgKyAob3B0aW9uYWwgPyAnJyA6IHNsYXNoKSArICcoPzonICsgKG9wdGlvbmFsID8gc2xhc2ggOiAnJykgKyAoZm9ybWF0IHx8ICcnKSArIChjYXB0dXJlIHx8IChmb3JtYXQgJiYgJyhbXi8uXSs/KScgfHwgJyhbXi9dKz8pJykpICsgJyknICsgKG9wdGlvbmFsIHx8ICcnKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAucmVwbGFjZSgvKFtcXC8uXSkvZywgJ1xcXFwkMScpXG4gICAgICAgICAgICAucmVwbGFjZSgvX19wbHVzX18vZywgJyguKyknKVxuICAgICAgICAgICAgLnJlcGxhY2UoL1xcKi9nLCAnKC4qKScpO1xuXG4gICAgICAgIHJldHVybiBuZXcgUmVnRXhwKCdeJyArIHBhdGggKyAnJCcsIHNlbnNpdGl2ZSA/ICcnIDogJ2knKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkIGFuIGFjdGlvbiBhbmQgaGFuZGxlclxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd8UmVnRXhwfSBhY3Rpb24gbmFtZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrXG4gICAgICogQHJldHVybiBzZWxmXG4gICAgKi9cbiAgICBHcmFwbmVsLnByb3RvdHlwZS5nZXQgPSBHcmFwbmVsLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihyb3V0ZSwgaGFuZGxlcil7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgICAgIGtleXMgPSBbXSxcbiAgICAgICAgICAgIHJlZ2V4ID0gR3JhcG5lbC5yZWdleFJvdXRlKHJvdXRlLCBrZXlzKTtcblxuICAgICAgICB2YXIgaW52b2tlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIC8vIElmIGFjdGlvbiBpcyBpbnN0YW5jZSBvZiBSZWdFeCwgbWF0Y2ggdGhlIGFjdGlvblxuICAgICAgICAgICAgdmFyIG1hdGNoID0gc2VsZi5hbmNob3IuZ2V0KCkubWF0Y2gocmVnZXgpO1xuICAgICAgICAgICAgLy8gVGVzdCBtYXRjaGVzIGFnYWluc3QgY3VycmVudCBhY3Rpb25cbiAgICAgICAgICAgIGlmKG1hdGNoKXtcbiAgICAgICAgICAgICAgICAvLyBNYXRjaCBmb3VuZFxuICAgICAgICAgICAgICAgIHZhciBldmVudCA9IHtcbiAgICAgICAgICAgICAgICAgICAgcm91dGUgOiByb3V0ZSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgOiBzZWxmLmFuY2hvci5nZXQoKSxcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlciA6IGhhbmRsZXIsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcyA6IHNlbGYucGFyYW1zLFxuICAgICAgICAgICAgICAgICAgICByZWdleCA6IG1hdGNoLFxuICAgICAgICAgICAgICAgICAgICBwcm9wYWdhdGVFdmVudCA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHByZXZpb3VzU3RhdGUgOiBzZWxmLnN0YXRlLFxuICAgICAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdCA6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByb3BhZ2F0ZUV2ZW50ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gVHJpZ2dlciBtYWluIGV2ZW50XG4gICAgICAgICAgICAgICAgc2VsZi50cmlnZ2VyKCdtYXRjaCcsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICAvLyBDb250aW51ZT9cbiAgICAgICAgICAgICAgICBpZighZXZlbnQucHJvcGFnYXRlRXZlbnQpIHJldHVybiBzZWxmO1xuICAgICAgICAgICAgICAgIC8vIFNhdmUgbmV3IHN0YXRlXG4gICAgICAgICAgICAgICAgc2VsZi5zdGF0ZSA9IGV2ZW50O1xuICAgICAgICAgICAgICAgIC8vIENhbGxiYWNrXG4gICAgICAgICAgICAgICAgdmFyIHJlcSA9IHsgcGFyYW1zIDoge30sIGtleXMgOiBrZXlzLCBtYXRjaGVzIDogZXZlbnQucmVnZXguc2xpY2UoMSkgfTtcbiAgICAgICAgICAgICAgICAvLyBCdWlsZCBwYXJhbWV0ZXJzXG4gICAgICAgICAgICAgICAgc2VsZi5fZm9yRWFjaChyZXEubWF0Y2hlcywgZnVuY3Rpb24odmFsdWUsIGkpe1xuICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gKGtleXNbaV0gJiYga2V5c1tpXS5uYW1lKSA/IGtleXNbaV0ubmFtZSA6IGk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFBhcmFtZXRlciBrZXkgd2lsbCBiZSBpdHMga2V5IG9yIHRoZSBpdGVyYXRpb24gaW5kZXguIFRoaXMgaXMgdXNlZnVsIGlmIGEgd2lsZGNhcmQgKCopIGlzIG1hdGNoZWRcbiAgICAgICAgICAgICAgICAgICAgcmVxLnBhcmFtc1trZXldID0gKHZhbHVlKSA/IGRlY29kZVVSSUNvbXBvbmVudCh2YWx1ZSkgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gQ2FsbCBoYW5kbGVyXG4gICAgICAgICAgICAgICAgaGFuZGxlci5jYWxsKHNlbGYsIHJlcSwgZXZlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gUmV0dXJucyBzZWxmXG4gICAgICAgICAgICByZXR1cm4gc2VsZjtcbiAgICAgICAgfVxuICAgICAgICAvLyBJbnZva2UgYW5kIGFkZCBsaXN0ZW5lcnMgLS0gdGhpcyB1c2VzIGxlc3MgY29kZVxuICAgICAgICByZXR1cm4gaW52b2tlKCkub24oJ2luaXRpYWxpemVkIGhhc2hjaGFuZ2UnLCBpbnZva2UpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGQgYW4gZXZlbnQgbGlzdGVuZXJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfEFycmF5fSBldmVudFxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrXG4gICAgICogQHJldHVybiBzZWxmXG4gICAgKi9cbiAgICBHcmFwbmVsLnByb3RvdHlwZS5vbiA9IEdyYXBuZWwucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbihldmVudCwgaGFuZGxlcil7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcyxcbiAgICAgICAgICAgIGV2ZW50cyA9IGV2ZW50LnNwbGl0KCcgJyk7XG5cbiAgICAgICAgdGhpcy5fZm9yRWFjaChldmVudHMsIGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgICAgICAgIGlmKHNlbGYuZXZlbnRzW2V2ZW50XSl7XG4gICAgICAgICAgICAgICAgc2VsZi5ldmVudHNbZXZlbnRdLnB1c2goaGFuZGxlcik7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICBzZWxmLmV2ZW50c1tldmVudF0gPSBbaGFuZGxlcl07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxsIEdyYXBuZWwoKS5yb3V0ZXIgY29uc3RydWN0b3IgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5XG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtzZWxmfSBSb3V0ZXJcbiAgICAqL1xuICAgIEdyYXBuZWwuUm91dGVyID0gR3JhcG5lbC5wcm90b3R5cGUucm91dGVyID0gR3JhcG5lbDtcbiAgICAvKipcbiAgICAgKiBBbGxvdyBjb250ZXh0XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gUm91dGUgY29udGV4dFxuICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufSBBZGRzIHJvdXRlIHRvIGNvbnRleHRcbiAgICAqL1xuICAgIEdyYXBuZWwucHJvdG90eXBlLmNvbnRleHQgPSBmdW5jdGlvbihjb250ZXh0KXtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgY2FsbGJhY2spe1xuICAgICAgICAgICAgdmFyIHByZWZpeCA9IChjb250ZXh0LnNsaWNlKC0xKSAhPT0gJy8nKSA/IGNvbnRleHQgKyAnLycgOiBjb250ZXh0LFxuICAgICAgICAgICAgICAgIHBhdHRlcm4gPSBwcmVmaXggKyB2YWx1ZTtcblxuICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0LmNhbGwoc2VsZiwgcGF0dGVybiwgY2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZSByb3V0ZXMgYmFzZWQgb24gYW4gb2JqZWN0XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gUm91dGVzXG4gICAgICogQHJldHVybiB7c2VsZn0gUm91dGVyXG4gICAgKi9cbiAgICBHcmFwbmVsLmxpc3RlbiA9IGZ1bmN0aW9uKHJvdXRlcyl7XG4gICAgICAgIC8vIFJldHVybiBhIG5ldyBHcmFwbmVsIGluc3RhbmNlXG4gICAgICAgIHJldHVybiAoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIC8vIFRPRE86IEFjY2VwdCBtdWx0aS1sZXZlbCByb3V0ZXNcbiAgICAgICAgICAgIGZvcih2YXIga2V5IGluIHJvdXRlcyl7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXQuY2FsbCh0aGlzLCBrZXksIHJvdXRlc1trZXldKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0pLmNhbGwobmV3IEdyYXBuZWwoKSk7XG4gICAgfVxuICAgIC8vIFdpbmRvdyBvciBtb2R1bGU/XG4gICAgaWYoJ2Z1bmN0aW9uJyA9PT0gdHlwZW9mIHJvb3QuZGVmaW5lKXtcbiAgICAgICAgcm9vdC5kZWZpbmUoZnVuY3Rpb24ocmVxdWlyZSl7XG4gICAgICAgICAgICByZXR1cm4gR3JhcG5lbDtcbiAgICAgICAgfSk7XG4gICAgfWVsc2UgaWYoJ29iamVjdCcgPT09IHR5cGVvZiBleHBvcnRzKXtcbiAgICAgICAgZXhwb3J0cy5HcmFwbmVsID0gR3JhcG5lbDtcbiAgICB9ZWxzZXtcbiAgICAgICAgcm9vdC5HcmFwbmVsID0gR3JhcG5lbDtcbiAgICB9XG5cbn0pLmNhbGwoe30sIHdpbmRvdyk7XG4iLCJcInVzZSBzdHJpY3RcIlxuXG4jIGhlbHBlcnNcbmZpbmQgPSAobGlzdCwgZm4pIC0+XG4gIGZvciBpIGluIGxpc3RcbiAgICByZXR1cm4gaSBpZiBmbihpKVxuICBudWxsXG5cbiMgcmVxdWlyZVxue0dyYXBuZWx9ID0gcmVxdWlyZSAnLi9ncmFwbmVsJ1xuXG5jbGFzcyBXYXJkZW4gZXh0ZW5kcyBHcmFwbmVsXG4gIGNvbnN0cnVjdG9yOiAob3B0cyA9IHt9KSAtPlxuICAgIHN1cGVyXG4gICAgaWYgb3B0cy5yb3V0ZXMgaW5zdGFuY2VvZiBGdW5jdGlvblxuICAgICAgb3B0cy5yb3V0ZXMoQG1hdGNoKVxuICAgIGVsc2UgaWYgb3B0cy5yb3V0ZXMgaW5zdGFuY2VvZiBPYmplY3RcbiAgICAgIGZvciByb3V0ZSwgYWN0aW9uIG9mIHJvdXRlc1xuICAgICAgICBAbWF0Y2ggcm91dGUsIGFjdGlvblxuXG4gIEByZXBsYWNlTGlua3NUb0hhc2hDaGFuZ2U6IC0+XG4gICAgIyBUT0RPOiBSZW1vdmUgZGVwZW5kZW5jeSB0byBqUXVlcnlcbiAgICB0aHJvdyAnUmVxdWlyZSBqUXVlcnkgb3IgemVwdG8nIHVubGVzcyAkP1xuICAgICQoJ2JvZHknKS5vbiAnY2xpY2snLCAnYScsIChldmVudCkgPT5cbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICAgIGhyZWYgPSAkKGV2ZW50LnRhcmdldCkuYXR0cignaHJlZicpLnJlcGxhY2UgL14oI3xcXC8pLywgJydcbiAgICAgIFdhcmRlbi5uYXZpZ2F0ZShocmVmKVxuXG4gIEBuYXZpZ2F0ZTogKHBhdGgpID0+XG4gICAgcGF0aCA9IHBhdGgucmVwbGFjZSgvXigjfFxcLykvLCAnJylcbiAgICBsb2NhdGlvbi5ocmVmID0gJyMnK3BhdGhcblxuICBuYXZpZ2F0ZTogKHBhdGgpID0+XG4gICAgV2FyZGVuLm5hdmlnYXRlKHBhdGgsIEBwdXNoU3RhdGUpXG5cbiAgZmluZENvbnRyb2xsZXI6IChjb250cm9sbGVyTmFtZSkgPT5cbiAgICByZXF1aXJlIFwiY29udHJvbGxlcnMvI3tjb250cm9sbGVyTmFtZX0tY29udHJvbGxlclwiXG5cbiAgbWF0Y2g6IChyb3V0ZSwgcmVxdWlyZW1lbnQpID0+XG4gICAgW2NvbnRyb2xsZXJOYW1lLCBhY3Rpb25OYW1lXSA9IHJlcXVpcmVtZW50LnNwbGl0KCcjJylcbiAgICBDb250cm9sbGVyID0gQGZpbmRDb250cm9sbGVyIGNvbnRyb2xsZXJOYW1lXG5cbiAgICBjb250aW51ZUFueXdheSA9IChtYXliZVByb21pc2UsIG5leHQpIC0+IG1heWJlUHJvbWlzZT8udGhlbj8obmV4dCkgPyBuZXh0KClcblxuICAgIGFjdGlvbiA9IChyZXEpID0+XG4gICAgICBsYXN0Q29udHJvbGxlciA9IEBjdXJyZW50Q29udHJvbGxlciA/IHt9XG4gICAgICBAY3VycmVudENvbnRyb2xsZXIgPSBuZXcgQ29udHJvbGxlciB7QHB1c2hTdGF0ZX1cbiAgICAgIEBjdXJyZW50Q29udHJvbGxlci5zZXRMYXN0VXNpbmdzIChsYXN0Q29udHJvbGxlci51c2luZ3MgPyBbXSlcblxuICAgICAgY29udGludWVBbnl3YXkgQGN1cnJlbnRDb250cm9sbGVyLmJlZm9yZUFjdGlvbihyZXEucGFyYW1zKSwgPT5cbiAgICAgICAgY29udGludWVBbnl3YXkgQGN1cnJlbnRDb250cm9sbGVyW2FjdGlvbk5hbWVdKHJlcS5wYXJhbXMpLCA9PlxuICAgICAgICAgIEBjdXJyZW50Q29udHJvbGxlci5maXgoKVxuICAgICAgICAgIGNvbnRpbnVlQW55d2F5IGxhc3RDb250cm9sbGVyLmRpc3Bvc2U/KCksID0+XG4gICAgICAgICAgICBjb250aW51ZUFueXdheSBAY3VycmVudENvbnRyb2xsZXIuYWZ0ZXJBY3Rpb24ocmVxLnBhcmFtcyksID0+XG4gICAgICAgICAgICAgIHRyeSB3aW5kb3cuZGlzcGF0Y2hFdmVudCBuZXcgQ3VzdG9tRXZlbnQgJ3dhcmRlbjpyb3V0ZWQnLCB7cmVxLCBjb250cm9sbGVyTmFtZSwgYWN0aW9uTmFtZX1cblxuICAgIEBnZXQgcm91dGUsIGFjdGlvblxuXG5jbGFzcyBXYXJkZW4uQ29udHJvbGxlclxuICBjb25zdHJ1Y3RvcjogKG9wdHMpIC0+XG4gICAgQHB1c2hTdGF0ZSA9IG9wdHM/LnB1c2hTdGF0ZSA/IGZhbHNlXG4gICAgQGZpeGVkID0gZmFsc2VcbiAgICBAbGFzdFVzaW5ncyA9IFtdXG4gICAgQHVzaW5ncyA9IFtdXG5cbiAgQGZpbmRJbnN0YW5jZTogKHVzaW5ncywgdGFyZ2V0KSAtPlxuICAgIChmaW5kIHVzaW5ncywgKHVzaW5nKSAtPlxuICAgICAgaWYgKHR5cGVvZiB0YXJnZXQpIGlzICdzdHJpbmcnXG4gICAgICAgIHVzaW5nLmtleSBpcyB0YXJnZXRcbiAgICAgIGVsc2UgaWYgdGFyZ2V0IGluc3RhbmNlb2YgRnVuY3Rpb25cbiAgICAgICAgdXNpbmcuaW5zdGFuY2UuY29uc3RydWN0b3IgaXMgdGFyZ2V0XG4gICAgICBlbHNlIGlmIHRhcmdldCBpbnN0YW5jZW9mIE9iamVjdFxuICAgICAgICB1c2luZy5pbnN0YW5jZSBpcyB0YXJnZXRcbiAgICApPy5pbnN0YW5jZSA/IG51bGxcblxuICBfY3JlYXRlSW5zdGFuY2U6IChtYXliZU5ld2FibGUpIC0+XG4gICAgaWYgbWF5YmVOZXdhYmxlIGluc3RhbmNlb2YgRnVuY3Rpb25cbiAgICAgIHVubGVzcyBtYXliZU5ld2FibGU6OmRpc3Bvc2UgaW5zdGFuY2VvZiBGdW5jdGlvblxuICAgICAgICBjb25zb2xlLndhcm4oXCJUaGlzIGNsYXNzIGRvZXMgbm90IGhhdmUgZGlzcG9zZVwiLCBtYXliZU5ld2FibGUpXG4gICAgICBuZXcgbWF5YmVOZXdhYmxlXG4gICAgZWxzZSBpZiBtYXliZU5ld2FibGUgaW5zdGFuY2VvZiBPYmplY3RcbiAgICAgIHVubGVzcyBtYXliZU5ld2FibGUuZGlzcG9zZSBpbnN0YW5jZW9mIEZ1bmN0aW9uXG4gICAgICAgIGNvbnNvbGUud2FybihcIlRoaXMgb2JqZWN0IGRvZXMgbm90IGhhdmUgZGlzcG9zZVwiLCBtYXliZU5ld2FibGUpXG4gICAgICBtYXliZU5ld2FibGVcbiAgICBlbHNlXG4gICAgICB0aHJvdyBuZXcgRXJyb3IgXCJXYXJkZW4gY2FuJ3QgY29tcG9zZSAje21heWJlTmV3YWJsZT8udG9TdHJpbmc/KCkgPyBtYXliZU5ld2FibGV9XCJcblxuICBzZXRMYXN0VXNpbmdzOiAoQGxhc3RVc2luZ3MpIC0+XG5cbiAgX3JldXNlRnJvbTogKHVzaW5ncywgdGFyZ2V0LCBtYXliZU5ld2FibGUpIC0+XG4gICAgaW5zdGFuY2UgPSAoQGNvbnN0cnVjdG9yLmZpbmRJbnN0YW5jZSB1c2luZ3MsIHRhcmdldCkgPyBAX2NyZWF0ZUluc3RhbmNlIChtYXliZU5ld2FibGUgPyB0YXJnZXQpXG4gICAga2V5ID0gaWYgKHR5cGVvZiB0YXJnZXQpIGlzICdzdHJpbmcnIHRoZW4gdGFyZ2V0IGVsc2UgaW5zdGFuY2VcbiAgICBAdXNpbmdzLnB1c2gge2luc3RhbmNlLCBrZXl9XG4gICAgaW5zdGFuY2VcblxuICByZXVzZTogKHRhcmdldCwgbWF5YmVOZXdhYmxlID0gbnVsbCkgPT5cbiAgICB0aHJvdyAnUG9zdCBmaXhlZCByZXVzZSBleGNlcHRpb24nIGlmIEBmaXhlZFxuICAgIEBfcmV1c2VGcm9tIEBsYXN0VXNpbmdzLCB0YXJnZXQsIG1heWJlTmV3YWJsZVxuXG4gIHVzZTogKHRhcmdldCwgbWF5YmVOZXdhYmxlKSAtPlxuICAgIHRocm93ICdQcmUgZml4ZWQgdXNlIGV4Y2VwdGlvbicgdW5sZXNzIEBmaXhlZFxuICAgIGluc3RhbmNlID0gQGNvbnN0cnVjdG9yLmZpbmRJbnN0YW5jZShAdXNpbmdzLCB0YXJnZXQpXG4gICAgcmV0dXJuIGluc3RhbmNlIGlmIGluc3RhbmNlP1xuICAgIEBfcmV1c2VGcm9tIEB1c2luZ3MsIHRhcmdldCwgbWF5YmVOZXdhYmxlXG5cbiAgbmF2aWdhdGU6IChwYXRoKSA9PiBXYXJkZW4ubmF2aWdhdGUocGF0aClcblxuICBmaXg6IC0+XG4gICAgdGhyb3cgJ1dhcmRlbi5Db250cm9sbGVyI2ZpeCBjYW4gYmUgY2FsbGVkIG9ubHkgb25jZScgaWYgQGZpeGVkXG5cbiAgICAjIGRpc3Bvc2UgbGFzdFVzaW5nc1xuICAgIGZvciB1c2VkIGluIEBsYXN0VXNpbmdzXG4gICAgICBhbHNvVXNlZCA9IEBjb25zdHJ1Y3Rvci5maW5kSW5zdGFuY2UoQHVzaW5ncywgdXNlZC5rZXkpXG4gICAgICB1bmxlc3MgYWxzb1VzZWQ/IHRoZW4gdXNlZC5pbnN0YW5jZS5kaXNwb3NlKClcblxuICAgIEBmaXhlZCA9IHRydWVcbiAgICBkZWxldGUgQGxhc3RVc2luZ3NcblxuICBkaXNwb3NlOiA9PlxuICAgIGRlbGV0ZSBAdXNpbmdzXG5cbiAgYmVmb3JlQWN0aW9uOiAocGFyYW1zKSAtPiAjIG92ZXJyaWRlIG1lXG5cbiAgYWZ0ZXJBY3Rpb246IChwYXJhbXMpIC0+ICMgb3ZlcnJpZGUgbWVcblxuaWYgJ2Z1bmN0aW9uJyBpcyB0eXBlb2Ygd2luZG93LmRlZmluZVxuICB3aW5kb3cuZGVmaW5lIChyZXF1aXJlKSAtPiBXYXJkZW5cbmVsc2VcbiAgd2luZG93LldhcmRlbiA9IFdhcmRlblxuIiwicmVxdWlyZSAnLi9ib3dlcl9jb21wb25lbnRzL21vbWljL21vbWljJ1xucmVxdWlyZSAnLi9ib3dlcl9jb21wb25lbnRzL3dhcmRlbi9zcmMvd2FyZGVuJ1xuXG53aW5kb3cubXogPSB7fVxubXouTW9kZWwgPSBNb21pYy5Nb2RlbFxubXouUm91dGVyID0gV2FyZGVuXG5tei5Db250cm9sbGVyID0gV2FyZGVuLkNvbnRyb2xsZXJcblxuY2xhc3MgbXouQXBwbGljYXRpb25cbiAgc2V0dXA6IChvcHRpb25zKSAtPiBuZXcgUHJvbWlzZSAoZG9uZSkgPT5cbiAgICBtei5Nb2RlbC5zZXR1cCh7XG4gICAgICBuYW1lOiBvcHRpb25zPy5uYW1lID8gJ2FwcCdcbiAgICAgIGNvbGxlY3Rpb25zOiBvcHRpb25zPy5jb2xsZWN0aW9ucyA/IFtdXG4gICAgfSkudGhlbiA9PlxuICAgICAgaW5pdCA9IC0+XG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyICd3YXJkZW46cm91dGVkJ1xuICAgICAgICBkb25lKClcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyICd3YXJkZW46cm91dGVkJywgaW5pdFxuICAgICAgbXoucm91dGVyID0gbmV3IG16LlJvdXRlcihvcHRzLnJvdXRlcilcbiJdfQ==
